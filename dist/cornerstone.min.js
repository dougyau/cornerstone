/*! cornerstone-core - 0.0.0-semantically-released - 2023-05-15 | (c) 2016 Chris Hafey | https://github.com/cornerstonejs/cornerstone */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("cornerstone-core",[],t):"object"==typeof exports?exports["cornerstone-core"]=t():e.cornerstone=t()}(window,function(){return n=[function(U,e,t){"use strict";function N(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}t.r(e),t.d(e,"drawImage",function(){return r}),t.d(e,"generateLut",function(){return Et}),t.d(e,"getDefaultViewport",function(){return l}),t.d(e,"setDefaultViewport",function(){return q}),t.d(e,"requestAnimationFrame",function(){return qt}),t.d(e,"storedPixelDataToCanvasImageData",function(){return qe}),t.d(e,"storedColorPixelDataToCanvasImageData",function(){return Rt}),t.d(e,"storedPixelDataToCanvasImageDataColorLUT",function(){return Ot}),t.d(e,"storedPixelDataToCanvasImageDataPseudocolorLUT",function(){return At}),t.d(e,"internal",function(){return Jt}),t.d(e,"renderLabelMapImage",function(){return Ut}),t.d(e,"renderPseudoColorImage",function(){return Mt}),t.d(e,"renderColorImage",function(){return O}),t.d(e,"renderGrayscaleImage",function(){return Lt}),t.d(e,"renderWebImage",function(){return o5}),t.d(e,"renderToCanvas",function(){return a5}),t.d(e,"canvasToPixel",function(){return Ve}),t.d(e,"disable",function(){return Ue}),t.d(e,"displayImage",function(){return Ne}),t.d(e,"draw",function(){return Be}),t.d(e,"drawInvalidated",function(){return ke}),t.d(e,"enable",function(){return Ht}),t.d(e,"getElementData",function(){return me}),t.d(e,"removeElementData",function(){return ce}),t.d(e,"getEnabledElement",function(){return c}),t.d(e,"addEnabledElement",function(){return B}),t.d(e,"getEnabledElementsByImageId",function(){return k}),t.d(e,"getEnabledElements",function(){return F}),t.d(e,"addLayer",function(){return Y}),t.d(e,"removeLayer",function(){return K}),t.d(e,"getLayer",function(){return Z}),t.d(e,"getLayers",function(){return $}),t.d(e,"getVisibleLayers",function(){return J}),t.d(e,"setActiveLayer",function(){return s}),t.d(e,"getActiveLayer",function(){return u}),t.d(e,"purgeLayers",function(){return ee}),t.d(e,"setLayerImage",function(){return Q}),t.d(e,"fitToWindow",function(){return Fe}),t.d(e,"getDefaultViewportForImage",function(){return Xt}),t.d(e,"getDisplayedArea",function(){return g}),t.d(e,"getImage",function(){return Yt}),t.d(e,"getPixels",function(){return Zt}),t.d(e,"getStoredPixels",function(){return Kt}),t.d(e,"getViewport",function(){return $t}),t.d(e,"loadImage",function(){return xe}),t.d(e,"loadAndCacheImage",function(){return Ee}),t.d(e,"registerImageLoader",function(){return Ie}),t.d(e,"registerUnknownImageLoader",function(){return Te}),t.d(e,"invalidate",function(){return Qt}),t.d(e,"invalidateImageId",function(){return e5}),t.d(e,"pageToPixel",function(){return n5}),t.d(e,"pixelToCanvas",function(){return r5}),t.d(e,"reset",function(){return l5}),t.d(e,"resize",function(){return Ge}),t.d(e,"setToPixelCoordinateSystem",function(){return T}),t.d(e,"setViewport",function(){return s5}),t.d(e,"updateImage",function(){return m}),t.d(e,"pixelDataToFalseColorData",function(){return le}),t.d(e,"rendering",function(){return i5}),t.d(e,"imageCache",function(){return we}),t.d(e,"metaData",function(){return t5}),t.d(e,"webGL",function(){return A}),t.d(e,"colors",function(){return v}),t.d(e,"convertImageToFalseColorImage",function(){return ue}),t.d(e,"convertToFalseColorImage",function(){return de}),t.d(e,"restoreImage",function(){return se}),t.d(e,"EVENTS",function(){return d}),t.d(e,"events",function(){return a}),t.d(e,"triggerEvent",function(){return f}),t.d(e,"imageLoadPoolManager",function(){return De}),t.d(e,"imageRetrievalPoolManager",function(){return Se}),t.d(e,"RequestPoolManager",function(){return Re});var d={NEW_IMAGE:"cornerstonenewimage",INVALIDATED:"cornerstoneinvalidated",PRE_RENDER:"cornerstoneprerender",IMAGE_CACHE_MAXIMUM_SIZE_CHANGED:"cornerstoneimagecachemaximumsizechanged",IMAGE_CACHE_PROMISE_REMOVED:"cornerstoneimagecachepromiseremoved",IMAGE_CACHE_FULL:"cornerstoneimagecachefull",IMAGE_CACHE_CHANGED:"cornerstoneimagecachechanged",WEBGL_TEXTURE_REMOVED:"cornerstonewebgltextureremoved",WEBGL_TEXTURE_CACHE_FULL:"cornerstonewebgltexturecachefull",IMAGE_LOADED:"cornerstoneimageloaded",IMAGE_LOAD_PROGRESS:"cornerstoneimageloadprogress",IMAGE_LOAD_FAILED:"cornerstoneimageloadfailed",ELEMENT_RESIZED:"cornerstoneelementresized",IMAGE_RENDERED:"cornerstoneimagerendered",LAYER_ADDED:"cornerstonelayeradded",LAYER_REMOVED:"cornerstonelayerremoved",ACTIVE_LAYER_CHANGED:"cornerstoneactivelayerchanged",ELEMENT_DISABLED:"cornerstoneelementdisabled",ELEMENT_ENABLED:"cornerstoneelementenabled"},a=new(function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.listeners={},this.namespaces={}}var t,n,r;return t=e,(n=[{key:"addEventNamespaceListener",value:function(e,t){e.indexOf(".")<=0||(this.namespaces[e]=t,this.addEventListener(e.split(".")[0],t))}},{key:"removeEventNamespaceListener",value:function(e){e.indexOf(".")<=0||!this.namespaces[e]||(this.removeEventListener(e.split(".")[0],this.namespaces[e]),delete this.namespaces[e])}},{key:"addEventListener",value:function(e,t){0<e.indexOf(".")?this.addEventNamespaceListener(e,t):(e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t))}},{key:"removeEventListener",value:function(e,t){if(0<e.indexOf("."))this.removeEventNamespaceListener(e);else if(e in this.listeners)for(var n=this.listeners[e],r=0,a=n.length;r<a;r++)if(n[r]===t)return void n.splice(r,1)}},{key:"dispatchEvent",value:function(e){if(!(e.type in this.listeners))return!0;for(var t=this.listeners[e.type].slice(),n=0,r=t.length;n<r;n++)t[n].call(this,e);return!e.defaultPrevented}}])&&N(t.prototype,n),r&&N(t,r),e}()),o=[];function c(e){if(void 0===e)throw new Error("getEnabledElement: parameter element must not be undefined");for(var t=0;t<o.length;t++)if(o[t].element===e)return o[t];throw new Error("element not enabled")}function B(e){if(void 0===e)throw new Error("getEnabledElement: enabledElement element must not be undefined");o.push(e)}function k(t){var n=[];return o.forEach(function(e){e.image&&e.image.imageId===t&&n.push(e)}),n}function F(){return o}function n(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var G=function(){return"".concat(n()+n(),"-").concat(n(),"-").concat(n(),"-").concat(n(),"-").concat(n()).concat(n()).concat(n())},z={viewport:{}},q=function(e){z.viewport=e||{}};function i(e,t){if(null==e)throw new Error(t)}function W(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,n=(i(e,"getImageScale: parameter windowSize must not be undefined"),i(t,"getImageScale: parameter image must not be undefined"),j(t,n)),r=t.rowPixelSpacing||1,t=t.columnPixelSpacing||1,a=1,o=1,r=(r<t?o=t/r:a=r/t,e.height/n.height/a),t=e.width/n.width/o;return{verticalScale:r,horizontalScale:t,scaleFactor:Math.min(t,r)}}var j=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return i(e,"getImageSize: parameter image must not be undefined"),i(e.width,"getImageSize: parameter image must have width"),i(e.height,"getImageSize: parameter image must have height"),null!=(t=t)&&0!==t&&180!==t?{height:e.width,width:e.height}:{width:e.width,height:e.height}},l=function(e,t){if(void 0===e)throw new Error("getDefaultViewport: parameter canvas must not be undefined");return void 0===t?Object.assign({},{scale:1,translation:{x:0,y:0},voi:{windowWidth:void 0,windowCenter:void 0},invert:!1,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:void 0,voiLUT:void 0,colormap:void 0,labelmap:!1,displayedArea:void 0},z.viewport):{scale:W(e,t,0).scaleFactor,translation:{x:0,y:0},voi:{windowWidth:t.windowWidth,windowCenter:t.windowCenter},invert:t.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:t.modalityLUT,voiLUT:t.voiLUT,colormap:t.colormap,labelmap:Boolean(t.labelmap),displayedArea:void 0}},g=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(t&&t.displayedArea)return t.displayedArea;if(void 0===e)throw new Error("getDisplayedArea: parameter image must not be undefined");return{tlhc:{x:1,y:1},brhc:{x:e.columns,y:e.rows},rowPixelSpacing:void 0===e.rowPixelSpacing?1:e.rowPixelSpacing,columnPixelSpacing:void 0===e.columnPixelSpacing?1:e.columnPixelSpacing,presentationSizeMode:"NONE"}},r=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];e.needsRedraw=!0,t&&(e.invalid=!0)},m=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],e=c(e);r(e,t)};function f(e,t){var n,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return"function"==typeof window.CustomEvent?n=new CustomEvent(t,{detail:r,cancelable:!0}):(n=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,r),e.dispatchEvent(n)}function H(e,t,n){f(t.element,e,{viewport:t.viewport,element:t.element,image:t.image,enabledElement:t,layerId:n})}function X(e,t){if(e.layerId===t.layerId)throw new Error("rescaleImage: both arguments represent the same layer");var n,r,a=e.image,o=t.image;a.imageId&&o.imageId&&(r=g(o,t.viewport),n=g(a,e.viewport),r=r.columnPixelSpacing*o.width/(n.columnPixelSpacing*a.width),o=t.viewport.scale/e.viewport.scale*r,t.viewport.scale=e.viewport.scale*o)}function Y(e,t,n){var r=G(),a=c(e),o=a.layers,i=(t&&(i=l(a.canvas,t),n)&&n.viewport&&(i=Object.assign(i,n.viewport)),!1!==a.syncViewports&&(a.syncViewports=!0),{image:t,layerId:r,viewport:i,options:n||{},renderingTools:{}});return o.length&&t&&X(o[0],i),o.push(i),H(d.LAYER_ADDED,a,r),1===o.length&&t&&s(e,r),r}function K(e,t){var n=c(e),r=n.layers,a=n.layers.findIndex(function(e){return e.layerId===t});-1!==a&&(r.splice(a,1),t===n.activeLayerId&&r.length&&s(e,r[0].layerId),H(d.LAYER_REMOVED,n,t))}function Z(e,t){return c(e).layers.find(function(e){return e.layerId===t})}function $(e){return c(e).layers}function J(e){return c(e).layers.filter(function(e){return e.options&&!1!==e.options.visible&&0!==e.options.opacity})}function s(e,t){var n=c(e);if(n.activeLayerId!==t){var r=n.layers.findIndex(function(e){return e.layerId===t});if(-1===r)throw new Error("setActiveLayer: layer not found in layers array");r=n.layers[r];if(!r.image)throw new Error("setActiveLayer: layer with undefined image cannot be set as active.");n.activeLayerId=t,n.image=r.image,n.viewport=r.viewport,m(e),H(d.ACTIVE_LAYER_CHANGED,n,t)}}function Q(e,t,n){var r=c(e),a=r.layers[0],e=n?Z(e,n):u(e);if(!e)throw new Error("setLayerImage: Layer not found");(e.image=t)?e.viewport||(r=l(r.canvas,t),e.options&&e.options.viewport&&(e.viewport=Object.assign(r,e.options.viewport)),a.layerId!==n&&X(a,e)):e.viewport=void 0}function u(e){var t=c(e);return t.layers.find(function(e){return e.layerId===t.activeLayerId})}function ee(e){e=c(e);e.layers=[],delete e.activeLayerId,delete e.lastSyncViewportsState}function te(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ne=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.NumberOfColors=256,this.Ramp="linear",this.TableRange=[0,255],this.HueRange=[0,.66667],this.SaturationRange=[1,1],this.ValueRange=[1,1],this.AlphaRange=[1,1],this.NaNColor=[128,0,0,255],this.BelowRangeColor=[0,0,0,255],this.UseBelowRangeColor=!0,this.AboveRangeColor=[255,255,255,255],this.UseAboveRangeColor=!0,this.InputRange=[0,255],this.Table=[]}var t,n,r;return t=e,(n=[{key:"setNumberOfTableValues",value:function(e){this.NumberOfColors=e}},{key:"setRamp",value:function(e){this.Ramp=e}},{key:"setTableRange",value:function(e,t){this.TableRange[0]=e,this.TableRange[1]=t}},{key:"setHueRange",value:function(e,t){this.HueRange[0]=e,this.HueRange[1]=t}},{key:"setSaturationRange",value:function(e,t){this.SaturationRange[0]=e,this.SaturationRange[1]=t}},{key:"setValueRange",value:function(e,t){this.ValueRange[0]=e,this.ValueRange[1]=t}},{key:"setRange",value:function(e,t){this.InputRange[0]=e,this.InputRange[1]=t}},{key:"setAlphaRange",value:function(e,t){this.AlphaRange[0]=e,this.AlphaRange[1]=t}},{key:"getColor",value:function(e){return this.mapValue(e)}},{key:"build",value:function(e){if(!(1<this.Table.length)||e){this.Table=[];var t,n,r,a,o=this.NumberOfColors-1;o?(t=(this.HueRange[1]-this.HueRange[0])/o,n=(this.SaturationRange[1]-this.SaturationRange[0])/o,r=(this.ValueRange[1]-this.ValueRange[0])/o,a=(this.AlphaRange[1]-this.AlphaRange[0])/o):t=n=r=a=0;for(var i=0;i<=o;i++){var l=this.HueRange[0]+i*t,s=this.SaturationRange[0]+i*n,u=this.ValueRange[0]+i*r,d=this.AlphaRange[0]+i*a,m=function(e,t,n){if(1<e)throw new Error("HSVToRGB expects hue < 1");var r=[];if(0===t)r[0]=n,r[1]=n,r[2]=n;else{var a=Math.floor(6*e),e=6*e-a,o=n*(1-t),i=n*(1-t*e),l=n*(1-t*(1-e));switch(a){case 0:case 6:r[0]=n,r[1]=l,r[2]=o;break;case 1:r[0]=i,r[1]=n,r[2]=o;break;case 2:r[0]=o,r[1]=n,r[2]=l;break;case 3:r[0]=o,r[1]=i,r[2]=n;break;case 4:r[0]=l,r[1]=o,r[2]=n;break;case 5:r[0]=n,r[1]=o,r[2]=i}}return r}(l,s,u),c=[];switch(this.Ramp){case"scurve":c[0]=Math.floor(127.5*(1+Math.cos((1-m[0])*Math.PI))),c[1]=Math.floor(127.5*(1+Math.cos((1-m[1])*Math.PI))),c[2]=Math.floor(127.5*(1+Math.cos((1-m[2])*Math.PI))),c[3]=Math.floor(255*d);break;case"linear":c[0]=Math.floor(255*m[0]+.5),c[1]=Math.floor(255*m[1]+.5),c[2]=Math.floor(255*m[2]+.5),c[3]=Math.floor(255*d+.5);break;case"sqrt":c[0]=Math.floor(255*Math.sqrt(m[0])+.5),c[1]=Math.floor(255*Math.sqrt(m[1])+.5),c[2]=Math.floor(255*Math.sqrt(m[2])+.5),c[3]=Math.floor(255*Math.sqrt(d)+.5);break;default:throw new Error("Invalid Ramp value (".concat(this.Ramp,")"))}this.Table.push(c)}this.buildSpecialColors()}}},{key:"buildSpecialColors",value:function(){var e=this.NumberOfColors,t=e+0,n=e+1,r=e+2;this.UseBelowRangeColor||0===e?this.Table[t]=this.BelowRangeColor:this.Table[t]=this.Table[0],this.UseAboveRangeColor||0===e?this.Table[n]=this.AboveRangeColor:this.Table[n]=this.Table[e-1],this.Table[r]=this.NaNColor}},{key:"mapValue",value:function(e){var t=this.getIndex(e);if(t<0)return this.NaNColor;if(0===t){if(this.UseBelowRangeColor&&e<this.TableRange[0])return this.BelowRangeColor}else if(t===this.NumberOfColors-1&&this.UseAboveRangeColor&&e>this.TableRange[1])return this.AboveRangeColor;return this.Table[t]}},{key:"getIndex",value:function(e){var t={Range:[]};return t.MaxIndex=this.NumberOfColors-1,t.Shift=-this.TableRange[0],this.TableRange[1]<=this.TableRange[0]?t.Scale=Number.MAX_VALUE:t.Scale=t.MaxIndex/(this.TableRange[1]-this.TableRange[0]),t.Range[0]=this.TableRange[0],t.Range[1]=this.TableRange[1],isNaN(e)?-1:(e=(e=e)<(t=t).Range[0]?t.MaxIndex+0+1.5:e>t.Range[1]?t.MaxIndex+1+1.5:(e+t.Shift)*t.Scale,(t=Math.floor(e))===this.NumberOfColors+0?t=0:t===this.NumberOfColors+1&&(t=this.NumberOfColors-1),t)}},{key:"setTableValue",value:function(e,t){if(5===arguments.length&&(t=Array.prototype.slice.call(arguments,1)),e<0)throw new Error("Can't set the table value for negative index (".concat(e,")"));e>=this.NumberOfColors&&new Error("Index ".concat(e," is greater than the number of colors ").concat(this.NumberOfColors)),this.Table[e]=t,0!==e&&e!==this.NumberOfColors-1||this.buildSpecialColors()}}])&&te(t.prototype,n),r&&te(t,r),e}(),re=[0,0,0,0],h={hotIron:{name:"Hot Iron",numOfColors:256,colors:[[0,0,0,255],[2,0,0,255],[4,0,0,255],[6,0,0,255],[8,0,0,255],[10,0,0,255],[12,0,0,255],[14,0,0,255],[16,0,0,255],[18,0,0,255],[20,0,0,255],[22,0,0,255],[24,0,0,255],[26,0,0,255],[28,0,0,255],[30,0,0,255],[32,0,0,255],[34,0,0,255],[36,0,0,255],[38,0,0,255],[40,0,0,255],[42,0,0,255],[44,0,0,255],[46,0,0,255],[48,0,0,255],[50,0,0,255],[52,0,0,255],[54,0,0,255],[56,0,0,255],[58,0,0,255],[60,0,0,255],[62,0,0,255],[64,0,0,255],[66,0,0,255],[68,0,0,255],[70,0,0,255],[72,0,0,255],[74,0,0,255],[76,0,0,255],[78,0,0,255],[80,0,0,255],[82,0,0,255],[84,0,0,255],[86,0,0,255],[88,0,0,255],[90,0,0,255],[92,0,0,255],[94,0,0,255],[96,0,0,255],[98,0,0,255],[100,0,0,255],[102,0,0,255],[104,0,0,255],[106,0,0,255],[108,0,0,255],[110,0,0,255],[112,0,0,255],[114,0,0,255],[116,0,0,255],[118,0,0,255],[120,0,0,255],[122,0,0,255],[124,0,0,255],[126,0,0,255],[128,0,0,255],[130,0,0,255],[132,0,0,255],[134,0,0,255],[136,0,0,255],[138,0,0,255],[140,0,0,255],[142,0,0,255],[144,0,0,255],[146,0,0,255],[148,0,0,255],[150,0,0,255],[152,0,0,255],[154,0,0,255],[156,0,0,255],[158,0,0,255],[160,0,0,255],[162,0,0,255],[164,0,0,255],[166,0,0,255],[168,0,0,255],[170,0,0,255],[172,0,0,255],[174,0,0,255],[176,0,0,255],[178,0,0,255],[180,0,0,255],[182,0,0,255],[184,0,0,255],[186,0,0,255],[188,0,0,255],[190,0,0,255],[192,0,0,255],[194,0,0,255],[196,0,0,255],[198,0,0,255],[200,0,0,255],[202,0,0,255],[204,0,0,255],[206,0,0,255],[208,0,0,255],[210,0,0,255],[212,0,0,255],[214,0,0,255],[216,0,0,255],[218,0,0,255],[220,0,0,255],[222,0,0,255],[224,0,0,255],[226,0,0,255],[228,0,0,255],[230,0,0,255],[232,0,0,255],[234,0,0,255],[236,0,0,255],[238,0,0,255],[240,0,0,255],[242,0,0,255],[244,0,0,255],[246,0,0,255],[248,0,0,255],[250,0,0,255],[252,0,0,255],[254,0,0,255],[255,0,0,255],[255,2,0,255],[255,4,0,255],[255,6,0,255],[255,8,0,255],[255,10,0,255],[255,12,0,255],[255,14,0,255],[255,16,0,255],[255,18,0,255],[255,20,0,255],[255,22,0,255],[255,24,0,255],[255,26,0,255],[255,28,0,255],[255,30,0,255],[255,32,0,255],[255,34,0,255],[255,36,0,255],[255,38,0,255],[255,40,0,255],[255,42,0,255],[255,44,0,255],[255,46,0,255],[255,48,0,255],[255,50,0,255],[255,52,0,255],[255,54,0,255],[255,56,0,255],[255,58,0,255],[255,60,0,255],[255,62,0,255],[255,64,0,255],[255,66,0,255],[255,68,0,255],[255,70,0,255],[255,72,0,255],[255,74,0,255],[255,76,0,255],[255,78,0,255],[255,80,0,255],[255,82,0,255],[255,84,0,255],[255,86,0,255],[255,88,0,255],[255,90,0,255],[255,92,0,255],[255,94,0,255],[255,96,0,255],[255,98,0,255],[255,100,0,255],[255,102,0,255],[255,104,0,255],[255,106,0,255],[255,108,0,255],[255,110,0,255],[255,112,0,255],[255,114,0,255],[255,116,0,255],[255,118,0,255],[255,120,0,255],[255,122,0,255],[255,124,0,255],[255,126,0,255],[255,128,4,255],[255,130,8,255],[255,132,12,255],[255,134,16,255],[255,136,20,255],[255,138,24,255],[255,140,28,255],[255,142,32,255],[255,144,36,255],[255,146,40,255],[255,148,44,255],[255,150,48,255],[255,152,52,255],[255,154,56,255],[255,156,60,255],[255,158,64,255],[255,160,68,255],[255,162,72,255],[255,164,76,255],[255,166,80,255],[255,168,84,255],[255,170,88,255],[255,172,92,255],[255,174,96,255],[255,176,100,255],[255,178,104,255],[255,180,108,255],[255,182,112,255],[255,184,116,255],[255,186,120,255],[255,188,124,255],[255,190,128,255],[255,192,132,255],[255,194,136,255],[255,196,140,255],[255,198,144,255],[255,200,148,255],[255,202,152,255],[255,204,156,255],[255,206,160,255],[255,208,164,255],[255,210,168,255],[255,212,172,255],[255,214,176,255],[255,216,180,255],[255,218,184,255],[255,220,188,255],[255,222,192,255],[255,224,196,255],[255,226,200,255],[255,228,204,255],[255,230,208,255],[255,232,212,255],[255,234,216,255],[255,236,220,255],[255,238,224,255],[255,240,228,255],[255,242,232,255],[255,244,236,255],[255,246,240,255],[255,248,244,255],[255,250,248,255],[255,252,252,255],[255,255,255,255]]},pet:{name:"PET",numColors:256,colors:[[0,0,0,255],[0,2,1,255],[0,4,3,255],[0,6,5,255],[0,8,7,255],[0,10,9,255],[0,12,11,255],[0,14,13,255],[0,16,15,255],[0,18,17,255],[0,20,19,255],[0,22,21,255],[0,24,23,255],[0,26,25,255],[0,28,27,255],[0,30,29,255],[0,32,31,255],[0,34,33,255],[0,36,35,255],[0,38,37,255],[0,40,39,255],[0,42,41,255],[0,44,43,255],[0,46,45,255],[0,48,47,255],[0,50,49,255],[0,52,51,255],[0,54,53,255],[0,56,55,255],[0,58,57,255],[0,60,59,255],[0,62,61,255],[0,65,63,255],[0,67,65,255],[0,69,67,255],[0,71,69,255],[0,73,71,255],[0,75,73,255],[0,77,75,255],[0,79,77,255],[0,81,79,255],[0,83,81,255],[0,85,83,255],[0,87,85,255],[0,89,87,255],[0,91,89,255],[0,93,91,255],[0,95,93,255],[0,97,95,255],[0,99,97,255],[0,101,99,255],[0,103,101,255],[0,105,103,255],[0,107,105,255],[0,109,107,255],[0,111,109,255],[0,113,111,255],[0,115,113,255],[0,117,115,255],[0,119,117,255],[0,121,119,255],[0,123,121,255],[0,125,123,255],[0,128,125,255],[1,126,127,255],[3,124,129,255],[5,122,131,255],[7,120,133,255],[9,118,135,255],[11,116,137,255],[13,114,139,255],[15,112,141,255],[17,110,143,255],[19,108,145,255],[21,106,147,255],[23,104,149,255],[25,102,151,255],[27,100,153,255],[29,98,155,255],[31,96,157,255],[33,94,159,255],[35,92,161,255],[37,90,163,255],[39,88,165,255],[41,86,167,255],[43,84,169,255],[45,82,171,255],[47,80,173,255],[49,78,175,255],[51,76,177,255],[53,74,179,255],[55,72,181,255],[57,70,183,255],[59,68,185,255],[61,66,187,255],[63,64,189,255],[65,63,191,255],[67,61,193,255],[69,59,195,255],[71,57,197,255],[73,55,199,255],[75,53,201,255],[77,51,203,255],[79,49,205,255],[81,47,207,255],[83,45,209,255],[85,43,211,255],[86,41,213,255],[88,39,215,255],[90,37,217,255],[92,35,219,255],[94,33,221,255],[96,31,223,255],[98,29,225,255],[100,27,227,255],[102,25,229,255],[104,23,231,255],[106,21,233,255],[108,19,235,255],[110,17,237,255],[112,15,239,255],[114,13,241,255],[116,11,243,255],[118,9,245,255],[120,7,247,255],[122,5,249,255],[124,3,251,255],[126,1,253,255],[128,0,255,255],[130,2,252,255],[132,4,248,255],[134,6,244,255],[136,8,240,255],[138,10,236,255],[140,12,232,255],[142,14,228,255],[144,16,224,255],[146,18,220,255],[148,20,216,255],[150,22,212,255],[152,24,208,255],[154,26,204,255],[156,28,200,255],[158,30,196,255],[160,32,192,255],[162,34,188,255],[164,36,184,255],[166,38,180,255],[168,40,176,255],[170,42,172,255],[171,44,168,255],[173,46,164,255],[175,48,160,255],[177,50,156,255],[179,52,152,255],[181,54,148,255],[183,56,144,255],[185,58,140,255],[187,60,136,255],[189,62,132,255],[191,64,128,255],[193,66,124,255],[195,68,120,255],[197,70,116,255],[199,72,112,255],[201,74,108,255],[203,76,104,255],[205,78,100,255],[207,80,96,255],[209,82,92,255],[211,84,88,255],[213,86,84,255],[215,88,80,255],[217,90,76,255],[219,92,72,255],[221,94,68,255],[223,96,64,255],[225,98,60,255],[227,100,56,255],[229,102,52,255],[231,104,48,255],[233,106,44,255],[235,108,40,255],[237,110,36,255],[239,112,32,255],[241,114,28,255],[243,116,24,255],[245,118,20,255],[247,120,16,255],[249,122,12,255],[251,124,8,255],[253,126,4,255],[255,128,0,255],[255,130,4,255],[255,132,8,255],[255,134,12,255],[255,136,16,255],[255,138,20,255],[255,140,24,255],[255,142,28,255],[255,144,32,255],[255,146,36,255],[255,148,40,255],[255,150,44,255],[255,152,48,255],[255,154,52,255],[255,156,56,255],[255,158,60,255],[255,160,64,255],[255,162,68,255],[255,164,72,255],[255,166,76,255],[255,168,80,255],[255,170,85,255],[255,172,89,255],[255,174,93,255],[255,176,97,255],[255,178,101,255],[255,180,105,255],[255,182,109,255],[255,184,113,255],[255,186,117,255],[255,188,121,255],[255,190,125,255],[255,192,129,255],[255,194,133,255],[255,196,137,255],[255,198,141,255],[255,200,145,255],[255,202,149,255],[255,204,153,255],[255,206,157,255],[255,208,161,255],[255,210,165,255],[255,212,170,255],[255,214,174,255],[255,216,178,255],[255,218,182,255],[255,220,186,255],[255,222,190,255],[255,224,194,255],[255,226,198,255],[255,228,202,255],[255,230,206,255],[255,232,210,255],[255,234,214,255],[255,236,218,255],[255,238,222,255],[255,240,226,255],[255,242,230,255],[255,244,234,255],[255,246,238,255],[255,248,242,255],[255,250,246,255],[255,252,250,255],[255,255,255,255]]},hotMetalBlue:{name:"Hot Metal Blue",numColors:256,colors:[[0,0,0,255],[0,0,2,255],[0,0,4,255],[0,0,6,255],[0,0,8,255],[0,0,10,255],[0,0,12,255],[0,0,14,255],[0,0,16,255],[0,0,17,255],[0,0,19,255],[0,0,21,255],[0,0,23,255],[0,0,25,255],[0,0,27,255],[0,0,29,255],[0,0,31,255],[0,0,33,255],[0,0,35,255],[0,0,37,255],[0,0,39,255],[0,0,41,255],[0,0,43,255],[0,0,45,255],[0,0,47,255],[0,0,49,255],[0,0,51,255],[0,0,53,255],[0,0,55,255],[0,0,57,255],[0,0,59,255],[0,0,61,255],[0,0,63,255],[0,0,65,255],[0,0,67,255],[0,0,69,255],[0,0,71,255],[0,0,73,255],[0,0,75,255],[0,0,77,255],[0,0,79,255],[0,0,81,255],[0,0,83,255],[0,0,84,255],[0,0,86,255],[0,0,88,255],[0,0,90,255],[0,0,92,255],[0,0,94,255],[0,0,96,255],[0,0,98,255],[0,0,100,255],[0,0,102,255],[0,0,104,255],[0,0,106,255],[0,0,108,255],[0,0,110,255],[0,0,112,255],[0,0,114,255],[0,0,116,255],[0,0,117,255],[0,0,119,255],[0,0,121,255],[0,0,123,255],[0,0,125,255],[0,0,127,255],[0,0,129,255],[0,0,131,255],[0,0,133,255],[0,0,135,255],[0,0,137,255],[0,0,139,255],[0,0,141,255],[0,0,143,255],[0,0,145,255],[0,0,147,255],[0,0,149,255],[0,0,151,255],[0,0,153,255],[0,0,155,255],[0,0,157,255],[0,0,159,255],[0,0,161,255],[0,0,163,255],[0,0,165,255],[0,0,167,255],[3,0,169,255],[6,0,171,255],[9,0,173,255],[12,0,175,255],[15,0,177,255],[18,0,179,255],[21,0,181,255],[24,0,183,255],[26,0,184,255],[29,0,186,255],[32,0,188,255],[35,0,190,255],[38,0,192,255],[41,0,194,255],[44,0,196,255],[47,0,198,255],[50,0,200,255],[52,0,197,255],[55,0,194,255],[57,0,191,255],[59,0,188,255],[62,0,185,255],[64,0,182,255],[66,0,179,255],[69,0,176,255],[71,0,174,255],[74,0,171,255],[76,0,168,255],[78,0,165,255],[81,0,162,255],[83,0,159,255],[85,0,156,255],[88,0,153,255],[90,0,150,255],[93,2,144,255],[96,4,138,255],[99,6,132,255],[102,8,126,255],[105,9,121,255],[108,11,115,255],[111,13,109,255],[114,15,103,255],[116,17,97,255],[119,19,91,255],[122,21,85,255],[125,23,79,255],[128,24,74,255],[131,26,68,255],[134,28,62,255],[137,30,56,255],[140,32,50,255],[143,34,47,255],[146,36,44,255],[149,38,41,255],[152,40,38,255],[155,41,35,255],[158,43,32,255],[161,45,29,255],[164,47,26,255],[166,49,24,255],[169,51,21,255],[172,53,18,255],[175,55,15,255],[178,56,12,255],[181,58,9,255],[184,60,6,255],[187,62,3,255],[190,64,0,255],[194,66,0,255],[198,68,0,255],[201,70,0,255],[205,72,0,255],[209,73,0,255],[213,75,0,255],[217,77,0,255],[221,79,0,255],[224,81,0,255],[228,83,0,255],[232,85,0,255],[236,87,0,255],[240,88,0,255],[244,90,0,255],[247,92,0,255],[251,94,0,255],[255,96,0,255],[255,98,3,255],[255,100,6,255],[255,102,9,255],[255,104,12,255],[255,105,15,255],[255,107,18,255],[255,109,21,255],[255,111,24,255],[255,113,26,255],[255,115,29,255],[255,117,32,255],[255,119,35,255],[255,120,38,255],[255,122,41,255],[255,124,44,255],[255,126,47,255],[255,128,50,255],[255,130,53,255],[255,132,56,255],[255,134,59,255],[255,136,62,255],[255,137,65,255],[255,139,68,255],[255,141,71,255],[255,143,74,255],[255,145,76,255],[255,147,79,255],[255,149,82,255],[255,151,85,255],[255,152,88,255],[255,154,91,255],[255,156,94,255],[255,158,97,255],[255,160,100,255],[255,162,103,255],[255,164,106,255],[255,166,109,255],[255,168,112,255],[255,169,115,255],[255,171,118,255],[255,173,121,255],[255,175,124,255],[255,177,126,255],[255,179,129,255],[255,181,132,255],[255,183,135,255],[255,184,138,255],[255,186,141,255],[255,188,144,255],[255,190,147,255],[255,192,150,255],[255,194,153,255],[255,196,156,255],[255,198,159,255],[255,200,162,255],[255,201,165,255],[255,203,168,255],[255,205,171,255],[255,207,174,255],[255,209,176,255],[255,211,179,255],[255,213,182,255],[255,215,185,255],[255,216,188,255],[255,218,191,255],[255,220,194,255],[255,222,197,255],[255,224,200,255],[255,226,203,255],[255,228,206,255],[255,229,210,255],[255,231,213,255],[255,233,216,255],[255,235,219,255],[255,237,223,255],[255,239,226,255],[255,240,229,255],[255,242,232,255],[255,244,236,255],[255,246,239,255],[255,248,242,255],[255,250,245,255],[255,251,249,255],[255,253,252,255],[255,255,255,255]]},pet20Step:{name:"PET 20 Step",numColors:256,colors:[[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255]]},gray:{name:"Gray",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,1,1]]}},jet:{name:"Jet",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.35,0,0],[.66,1,1],[.89,1,1],[1,.5,.5]],green:[[0,0,0],[.125,0,0],[.375,1,1],[.64,1,1],[.91,0,0],[1,0,0]],blue:[[0,.5,.5],[.11,1,1],[.34,1,1],[.65,0,0],[1,0,0]]}},hsv:{name:"HSV",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[.15873,1,1],[.174603,.96875,.96875],[.333333,.03125,.03125],[.349206,0,0],[.666667,0,0],[.68254,.03125,.03125],[.84127,.96875,.96875],[.857143,1,1],[1,1,1]],green:[[0,0,0],[.15873,.9375,.9375],[.174603,1,1],[.507937,1,1],[.666667,.0625,.0625],[.68254,0,0],[1,0,0]],blue:[[0,0,0],[.333333,0,0],[.349206,.0625,.0625],[.507937,1,1],[.84127,1,1],[.857143,.9375,.9375],[1,.09375,.09375]]}},hot:{name:"Hot",numColors:256,gamma:1,segmentedData:{red:[[0,.0416,.0416],[.365079,1,1],[1,1,1]],green:[[0,0,0],[.365079,0,0],[.746032,1,1],[1,1,1]],blue:[[0,0,0],[.746032,0,0],[1,1,1]]}},cool:{name:"Cool",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,1,1],[1,0,0]],blue:[[0,1,1],[1,1,1]]}},spring:{name:"Spring",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,0,0]]}},summer:{name:"Summer",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,.5,.5],[1,1,1]],blue:[[0,.4,.4],[1,.4,.4]]}},autumn:{name:"Autumn",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,0,0]]}},winter:{name:"Winter",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,0,0]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,.5,.5]]}},bone:{name:"Bone",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.746032,.652778,.652778],[1,1,1]],green:[[0,0,0],[.365079,.319444,.319444],[.746032,.777778,.777778],[1,1,1]],blue:[[0,0,0],[.365079,.444444,.444444],[1,1,1]]}},copper:{name:"Copper",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.809524,1,1],[1,1,1]],green:[[0,0,0],[1,.7812,.7812]],blue:[[0,0,0],[1,.4975,.4975]]}},spectral:{name:"Spectral",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.05,.4667,.4667],[.1,.5333,.5333],[.15,0,0],[.2,0,0],[.25,0,0],[.3,0,0],[.35,0,0],[.4,0,0],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,.7333,.7333],[.7,.9333,.9333],[.75,1,1],[.8,1,1],[.85,1,1],[.9,.8667,.8667],[.95,.8,.8],[1,.8,.8]],green:[[0,0,0],[.05,0,0],[.1,0,0],[.15,0,0],[.2,0,0],[.25,.4667,.4667],[.3,.6,.6],[.35,.6667,.6667],[.4,.6667,.6667],[.45,.6,.6],[.5,.7333,.7333],[.55,.8667,.8667],[.6,1,1],[.65,1,1],[.7,.9333,.9333],[.75,.8,.8],[.8,.6,.6],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]],blue:[[0,0,0],[.05,.5333,.5333],[.1,.6,.6],[.15,.6667,.6667],[.2,.8667,.8667],[.25,.8667,.8667],[.3,.8667,.8667],[.35,.6667,.6667],[.4,.5333,.5333],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,0,0],[.7,0,0],[.75,0,0],[.8,0,0],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]]}},coolwarm:{name:"CoolWarm",numColors:256,gamma:1,segmentedData:{red:[[0,.2298057,.2298057],[.03125,.26623388,.26623388],[.0625,.30386891,.30386891],[.09375,.342804478,.342804478],[.125,.38301334,.38301334],[.15625,.424369608,.424369608],[.1875,.46666708,.46666708],[.21875,.509635204,.509635204],[.25,.552953156,.552953156],[.28125,.596262162,.596262162],[.3125,.639176211,.639176211],[.34375,.681291281,.681291281],[.375,.722193294,.722193294],[.40625,.761464949,.761464949],[.4375,.798691636,.798691636],[.46875,.833466556,.833466556],[.5,.865395197,.865395197],[.53125,.897787179,.897787179],[.5625,.924127593,.924127593],[.59375,.944468518,.944468518],[.625,.958852946,.958852946],[.65625,.96732803,.96732803],[.6875,.969954137,.969954137],[.71875,.966811177,.966811177],[.75,.958003065,.958003065],[.78125,.943660866,.943660866],[.8125,.923944917,.923944917],[.84375,.89904617,.89904617],[.875,.869186849,.869186849],[.90625,.834620542,.834620542],[.9375,.795631745,.795631745],[.96875,.752534934,.752534934],[1,.705673158,.705673158]],green:[[0,.298717966,.298717966],[.03125,.353094838,.353094838],[.0625,.406535296,.406535296],[.09375,.458757618,.458757618],[.125,.50941904,.50941904],[.15625,.558148092,.558148092],[.1875,.604562568,.604562568],[.21875,.648280772,.648280772],[.25,.688929332,.688929332],[.28125,.726149107,.726149107],[.3125,.759599947,.759599947],[.34375,.788964712,.788964712],[.375,.813952739,.813952739],[.40625,.834302879,.834302879],[.4375,.849786142,.849786142],[.46875,.860207984,.860207984],[.5,.86541021,.86541021],[.53125,.848937047,.848937047],[.5625,.827384882,.827384882],[.59375,.800927443,.800927443],[.625,.769767752,.769767752],[.65625,.734132809,.734132809],[.6875,.694266682,.694266682],[.71875,.650421156,.650421156],[.75,.602842431,.602842431],[.78125,.551750968,.551750968],[.8125,.49730856,.49730856],[.84375,.439559467,.439559467],[.875,.378313092,.378313092],[.90625,.312874446,.312874446],[.9375,.24128379,.24128379],[.96875,.157246067,.157246067],[1,.01555616,.01555616]],blue:[[0,.753683153,.753683153],[.03125,.801466763,.801466763],[.0625,.84495867,.84495867],[.09375,.883725899,.883725899],[.125,.917387822,.917387822],[.15625,.945619588,.945619588],[.1875,.968154911,.968154911],[.21875,.98478814,.98478814],[.25,.995375608,.995375608],[.28125,.999836203,.999836203],[.3125,.998151185,.998151185],[.34375,.990363227,.990363227],[.375,.976574709,.976574709],[.40625,.956945269,.956945269],[.4375,.931688648,.931688648],[.46875,.901068838,.901068838],[.5,.865395561,.865395561],[.53125,.820880546,.820880546],[.5625,.774508472,.774508472],[.59375,.726736146,.726736146],[.625,.678007945,.678007945],[.65625,.628751763,.628751763],[.6875,.579375448,.579375448],[.71875,.530263762,.530263762],[.75,.481775914,.481775914],[.78125,.434243684,.434243684],[.8125,.387970225,.387970225],[.84375,.343229596,.343229596],[.875,.300267182,.300267182],[.90625,.259301199,.259301199],[.9375,.220525627,.220525627],[.96875,.184115123,.184115123],[1,.150232812,.150232812]]}},blues:{name:"Blues",numColors:256,gamma:1,segmentedData:{red:[[0,.9686274528503418,.9686274528503418],[.125,.8705882430076599,.8705882430076599],[.25,.7764706015586853,.7764706015586853],[.375,.6196078658103943,.6196078658103943],[.5,.41960784792900085,.41960784792900085],[.625,.25882354378700256,.25882354378700256],[.75,.12941177189350128,.12941177189350128],[.875,.0313725508749485,.0313725508749485],[1,.0313725508749485,.0313725508749485]],green:[[0,.9843137264251709,.9843137264251709],[.125,.9215686321258545,.9215686321258545],[.25,.8588235378265381,.8588235378265381],[.375,.7921568751335144,.7921568751335144],[.5,.6823529601097107,.6823529601097107],[.625,.572549045085907,.572549045085907],[.75,.4431372582912445,.4431372582912445],[.875,.3176470696926117,.3176470696926117],[1,.1882352977991104,.1882352977991104]],blue:[[0,1,1],[.125,.9686274528503418,.9686274528503418],[.25,.9372549057006836,.9372549057006836],[.375,.8823529481887817,.8823529481887817],[.5,.8392156958580017,.8392156958580017],[.625,.7764706015586853,.7764706015586853],[.75,.7098039388656616,.7098039388656616],[.875,.6117647290229797,.6117647290229797],[1,.41960784792900085,.41960784792900085]]}}};function ae(e,t){var n,r=[],a=t.length;for(e.sort(function(e,t){return e-t}),n=0;n<a;n++)r[n]=function(e,t){for(var n=0,r=e.length-1;n<=r;){var a=n+Math.floor((r-n)/2),o=e[a];if(o===t)return a;t<o?r=a-1:n=a+1}return n}(e,t[n]);return r}function oe(e,t,n){var r=[],a=[],o=[],i=[];for(n=null===n?1:n,u=0;u<t.length;u++){var l=t[u];r.push((e-1)*l[0]),a.push(l[1]),o.push(l[1])}for(var s=function(e,t,n){for(var r=(t-e)/((n=null===n?100:n)-1),a=[];0<n--;)a.push(e),e+=r;return a[a.length-1]=t,a}(0,1,e),u=0;u<e;u++)s[u]=(e-1)*Math.pow(s[u],n);var d=ae(r,s);for(u=1;u<e-1;u++){var m=d[u],c=(s[u]-r[m-1])/(r[m]-r[m-1]);i[u]=c*(a[m]-o[m-1])+o[m-1]}return i[0]=o[0],i[e-1]=a[t.length-1],i}function ie(e,t){var r=h[e];return!(r=r||(h[e]=t||{name:"",colors:[]})).colors&&r.segmentedData&&(r.colors=function(e,t,n){for(var r=[],a=oe(t=null===t?256:t,e.red,n=null===n?1:n),o=oe(t,e.green,n),i=oe(t,e.blue,n),l=0;l<t;l++){var s=Math.round(255*a[l]),u=Math.round(255*o[l]),d=Math.round(255*i[l]);r.push([s,u,d,255])}return r}(r.segmentedData,r.numColors,r.gamma)),{getId:function(){return e},getColorSchemeName:function(){return r.name},setColorSchemeName:function(e){r.name=e},getNumberOfColors:function(){return r.colors.length},setNumberOfColors:function(e){for(;r.colors.length<e;)r.colors.push(re);r.colors.length=e},getColor:function(e){return this.isValidIndex(e)?r.colors[e]:re},getColorRepeating:function(e){var t=r.colors.length;return this.getColor(e=t?e%t:0)},setColor:function(e,t){this.isValidIndex(e)&&(r.colors[e]=t)},addColor:function(e){r.colors.push(e)},insertColor:function(e,t){this.isValidIndex(e)&&r.colors.splice(e,1,t)},removeColor:function(e){this.isValidIndex(e)&&r.colors.splice(e,1)},clearColors:function(){r.colors=[]},buildLookupTable:function(e){if(e){var t=r.colors.length;e.setNumberOfTableValues(t);for(var n=0;n<t;n++)e.setTableValue(n,r.colors[n])}},createLookupTable:function(){var e=new ne;return this.buildLookupTable(e),e},isValidIndex:function(e){return 0<=e&&e<r.colors.length}}}var v={getColormap:ie,getColormapsList:function(){var n=[];return Object.keys(h).forEach(function(e){var t;h.hasOwnProperty(e)&&(t=h[e],n.push({id:e,name:t.name}))}),n.sort(function(e,t){e=e.name.toLowerCase(),t=t.name.toLowerCase();return e===t?0:e<t?-1:1}),n},LookupTable:ne};function le(e,t){if(e.color&&!e.falseColor)throw new Error("Color transforms are not implemented yet");var n,r,a=e.minPixelValue,o=0,i=0,l=e.width*e.height,s=e.origPixelData||e.getPixelData(),u=new Uint8Array(4*l);if(e.color=!0,e.falseColor=!0,e.origPixelData=s,t instanceof v.LookupTable)for(t.build();i<l;)n=s[i++],r=t.mapValue(n),u[o++]=r[0],u[o++]=r[1],u[o++]=r[2],u[o++]=r[3];else if(a<0)for(;i<l;)n=s[i++],u[o++]=t[n+-a][0],u[o++]=t[n+-a][1],u[o++]=t[n+-a][2],u[o++]=t[n+-a][3];else for(;i<l;)n=s[i++],u[o++]=t[n][0],u[o++]=t[n][1],u[o++]=t[n][2],u[o++]=t[n][3];e.rgba=!0,e.cachedLut=void 0,e.render=void 0,e.slope=1,e.intercept=0,e.minPixelValue=0,e.maxPixelValue=255,e.windowWidth=255,e.windowCenter=128,e.getPixelData=function(){return u}}function se(e){return!(!e.restore||"function"!=typeof e.restore||(e.restore(),0))}function ue(e,t){if(e.color&&!e.falseColor)throw new Error("Color transforms are not implemented yet");var n,r,a,o,i,l,s,u,d,m,c,g=(t=g=(g=t)&&"string"==typeof g?ie(g):g).getId();return e.colormapId!==g&&(se(e),g&&(r=e.minPixelValue||0,n=e.maxPixelValue||255,e.restore=(a=e).restore||(o=a.color,i=a.rgba,l=a.cachedLut,s=a.slope,u=a.windowWidth,d=a.windowCenter,m=a.minPixelValue,c=a.maxPixelValue,function(){var e;a.color=o,a.rgba=i,a.cachedLut=l,a.slope=s,a.windowWidth=u,a.windowCenter=d,a.minPixelValue=m,a.maxPixelValue=c,a.origPixelData&&(e=a.origPixelData,a.getPixelData=function(){return e}),a.origPixelData=void 0,a.colormapId=void 0,a.falseColor=void 0}),(t=t.createLookupTable()).setTableRange(r,n),le(e,t),r=function(e){for(var t,n=Number.MAX_VALUE,r=Number.MIN_VALUE,a=e.length,o=0;o<a;o++)n=n<(t=e[o])?n:t,r=t<r?r:t;return{minPixelValue:n,maxPixelValue:r}}(e.getPixelData()),e.minPixelValue=r.minPixelValue,e.maxPixelValue=r.maxPixelValue,e.windowWidth=255,e.windowCenter=128,e.colormapId=g),!0)}function de(e,t){return ue(c(e).image,t)}function me(e,t){e=c(e);return!1===e.data.hasOwnProperty(t)&&(e.data[t]={}),e.data[t]}function ce(e,t){delete c(e).data[t]}var p=new RegExp("Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini").test(navigator.userAgent)?524288e3:3758096384,w=0,b={},y=[];function ge(){if(!(w<=p)){for(y.sort(function(e,t){return e.timeStamp>t.timeStamp?-1:e.timeStamp<t.timeStamp?1:0});p<w;){var e=y[y.length-1].imageId;ve(e),f(a,d.IMAGE_CACHE_PROMISE_REMOVED,{imageId:e})}var t=pe();f(a,d.IMAGE_CACHE_FULL,t)}}function fe(t,e){if(void 0===t)throw new Error("putImageLoadObject: imageId must not be undefined");if(void 0===e.promise)throw new Error("putImageLoadObject: imageLoadObject.promise must not be undefined");if(!0===b.hasOwnProperty(t))throw new Error("putImageLoadObject: imageId already in cache");if(e.cancelFn&&"function"!=typeof e.cancelFn)throw new Error("putImageLoadObject: imageLoadObject.cancelFn must be a function");var n={loaded:!1,imageId:t,sharedCacheKey:void 0,imageLoadObject:e,timeStamp:Date.now(),sizeInBytes:0};b[t]=n,y.push(n),e.promise.then(function(e){if(-1!==y.indexOf(n)){if(n.loaded=!0,void 0===(n.image=e).sizeInBytes)throw new Error("putImageLoadObject: image.sizeInBytes must not be undefined");if(void 0===e.sizeInBytes.toFixed)throw new Error("putImageLoadObject: image.sizeInBytes is not a number");n.sizeInBytes=e.sizeInBytes,w+=n.sizeInBytes;var t={action:"addImage",image:n};f(a,d.IMAGE_CACHE_CHANGED,t),n.sharedCacheKey=e.sharedCacheKey,ge()}},function(){var e=b[t];y.splice(y.indexOf(e),1),delete b[t]})}function he(e){if(void 0===e)throw new Error("getImageLoadObject: imageId must not be undefined");e=b[e];if(void 0!==e)return e.timeStamp=Date.now(),e.imageLoadObject}function ve(e){if(void 0===e)throw new Error("removeImageLoadObject: imageId must not be undefined");var t,n=b[e];if(void 0===n)throw new Error("removeImageLoadObject: imageId was not present in imageCache");y.splice(y.indexOf(n),1),w-=n.sizeInBytes,f(a,d.IMAGE_CACHE_CHANGED,{action:"deleteImage",image:n}),(t=n.imageLoadObject).promise.then(function(){t.decache&&t.decache()},function(){t.decache&&t.decache()}),delete b[e]}function pe(){return{maximumSizeInBytes:p,cacheSizeInBytes:w,numberOfImagesCached:y.length}}var x,we={imageCache:b,cachedImages:y,setMaximumSizeBytes:function(e){if(void 0===e)throw new Error("setMaximumSizeBytes: parameter numBytes must not be undefined");if(void 0===e.toFixed)throw new Error("setMaximumSizeBytes: parameter numBytes must be a number");p=e,f(a,d.IMAGE_CACHE_MAXIMUM_SIZE_CHANGED),ge()},putImageLoadObject:fe,getImageLoadObject:he,removeImageLoadObject:ve,getCacheInfo:pe,purgeCache:function(){for(;0<y.length;)ve(y[0].imageId)},changeImageIdCacheSize:function(e,n){var r=b[e];r&&r.imageLoadObject.promise.then(function(e){var t=n-e.sizeInBytes,t=(e.sizeInBytes=n,r.sizeInBytes=n,w+=t,{action:"changeImageSize",image:e});f(a,d.IMAGE_CACHE_CHANGED,t)})}},be={};function ye(t,e){var n=t.indexOf(":"),n=t.substring(0,n),n=be[n];if(null==n){if(void 0!==x)return x(t);throw new Error("loadImageFromImageLoader: no image loader for imageId")}n=n(t,e);return n.promise.then(function(e){f(a,d.IMAGE_LOADED,{image:e})},function(e){f(a,d.IMAGE_LOAD_FAILED,{imageId:t,error:e})}),n}function xe(e,t){if(void 0===e)throw new Error("loadImage: parameter imageId must not be undefined");var n=he(e);return(void 0!==n?n:ye(e,t)).promise}function Ee(e,t){if(void 0===e)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");var n=he(e);return void 0===n&&fe(e,n=ye(e,t)),n.promise}function Ie(e,t){be[e]=t}function Te(e){var t=x;return x=e,t}function Ce(e,t){var n,r,a,o,i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return r=!(n=!0),{s:function(){i=i.call(e)},n:function(){var e=i.next();return n=e.done,e},e:function(e){r=!0,a=e},f:function(){try{n||null==i.return||i.return()}finally{if(r)throw a}}};if(Array.isArray(e)||(i=function(e,t){var n;if(e)return"string"==typeof e?Le(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Le(e,t):void 0}(e))||t&&e&&"number"==typeof e.length)return i&&(e=i),o=0,{s:t=function(){},n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Le(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Pe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function E(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}var Re=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");E(this,"requestPool",void 0),E(this,"awake",void 0),E(this,"numRequests",void 0),E(this,"maxNumRequests",void 0),E(this,"grabDelay",void 0),E(this,"timeoutHandle",void 0),this.requestPool={interaction:{0:[]},thumbnail:{0:[]},prefetch:{0:[]}},this.awake=!1,this.grabDelay=5,this.numRequests={interaction:0,thumbnail:0,prefetch:0},this.maxNumRequests={interaction:6,thumbnail:6,prefetch:5}}var t,n,r;return t=e,(n=[{key:"destroy",value:function(){this.timeoutHandle&&window.clearTimeout(this.timeoutHandle)}},{key:"addRequest",value:function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,a=4<arguments.length&&void 0!==arguments[4]&&arguments[4],e={requestFn:e,type:t,additionalDetails:n};void 0===this.requestPool[t][r]&&(this.requestPool[t][r]=[]),a?this.requestPool[t][r].unshift(e):this.requestPool[t][r].push(e),this.awake||(this.awake=!0,this.startGrabbing())}},{key:"filterRequests",value:function(n){var r=this;Object.keys(this.requestPool).forEach(function(e){var t=r.requestPool[e];Object.keys(t).forEach(function(e){t[e]=t[e].filter(function(e){return n(e)})})})}},{key:"clearRequestStack",value:function(e){if(!this.requestPool[e])throw new Error("No category for the type ".concat(e," found"));this.requestPool[e]={0:[]}}},{key:"sendRequest",value:function(e){var t=this,n=e.requestFn,r=e.type;this.numRequests[r]++,this.awake=!0,n().finally(function(){t.numRequests[r]--,t.startAgain()})}},{key:"startGrabbing",value:function(){for(var e=this.maxNumRequests.interaction+this.maxNumRequests.thumbnail+this.maxNumRequests.prefetch-(this.numRequests.interaction+this.numRequests.thumbnail+this.numRequests.prefetch),t=0;t<e;t++){var n=this.getNextRequest();if(!1===n)break;n&&this.sendRequest(n)}}},{key:"startAgain",value:function(){var e=this;this.awake&&(this.grabDelay?this.timeoutHandle=window.setTimeout(function(){e.startGrabbing()},this.grabDelay):this.startGrabbing())}},{key:"getSortedPriorityGroups",value:function(t){var n=this;return Object.keys(this.requestPool[t]).map(Number).filter(function(e){return n.requestPool[t][e].length}).sort()}},{key:"getNextRequest",value:function(){var e,t=this.getSortedPriorityGroups("interaction"),n=Ce(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(this.requestPool.interaction[r].length&&this.numRequests.interaction<this.maxNumRequests.interaction)return this.requestPool.interaction[r].shift()}}catch(e){n.e(e)}finally{n.f()}var a,o=this.getSortedPriorityGroups("thumbnail"),i=Ce(o);try{for(i.s();!(a=i.n()).done;){var l=a.value;if(this.requestPool.thumbnail[l].length&&this.numRequests.thumbnail<this.maxNumRequests.thumbnail)return this.requestPool.thumbnail[l].shift()}}catch(e){i.e(e)}finally{i.f()}var s,u=this.getSortedPriorityGroups("prefetch"),d=Ce(u);try{for(d.s();!(s=d.n()).done;){var m=s.value;if(this.requestPool.prefetch[m].length&&this.numRequests.prefetch<this.maxNumRequests.prefetch)return this.requestPool.prefetch[m].shift()}}catch(e){d.e(e)}finally{d.f()}return t.length||o.length||u.length||(this.awake=!1),!1}},{key:"getRequestPool",value:function(){return this.requestPool}}])&&Pe(t.prototype,n),r&&Pe(t,r),e}(),t=new Re,De=(t.maxNumRequests={interaction:1e3,thumbnail:1e3,prefetch:1e3},t.grabDelay=0,t),t=new Re,Se=(t.maxNumRequests={interaction:20,thumbnail:20,prefetch:20},t.grabDelay=0,t);function Ae(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _e(e){return Oe(e)}var Me=function(){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.reset()}var e,n,r;return e=t,(n=[{key:"reset",value:function(){this.m=[1,0,0,1,0,0]}},{key:"clone",value:function(){var e=new t;return e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5],e}},{key:"multiply",value:function(e){var t=this.m[0]*e.m[0]+this.m[2]*e.m[1],n=this.m[1]*e.m[0]+this.m[3]*e.m[1],r=this.m[0]*e.m[2]+this.m[2]*e.m[3],a=this.m[1]*e.m[2]+this.m[3]*e.m[3],o=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4],e=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5];this.m[0]=t,this.m[1]=n,this.m[2]=r,this.m[3]=a,this.m[4]=o,this.m[5]=e}},{key:"invert",value:function(){var e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*e,n=-this.m[1]*e,r=-this.m[2]*e,a=this.m[0]*e,o=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),e=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=t,this.m[1]=n,this.m[2]=r,this.m[3]=a,this.m[4]=o,this.m[5]=e}},{key:"rotate",value:function(e){var t=Math.cos(e),e=Math.sin(e),n=this.m[0]*t+this.m[2]*e,r=this.m[1]*t+this.m[3]*e,a=this.m[0]*-e+this.m[2]*t,e=this.m[1]*-e+this.m[3]*t;this.m[0]=n,this.m[1]=r,this.m[2]=a,this.m[3]=e}},{key:"translate",value:function(e,t){this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t}},{key:"scale",value:function(e,t){this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t}},{key:"transformPoint",value:function(e,t){var n=e,r=t;return{x:e=n*this.m[0]+r*this.m[2]+this.m[4],y:t=n*this.m[1]+r*this.m[3]+this.m[5]}}}])&&Ae(e.prototype,n),r&&Ae(e,r),t}(),Oe=function(e,t){var n,r,a=new Me,o=(a.translate(e.canvas.width/2,e.canvas.height/2),e.viewport.rotation),i=(0!==o&&a.rotate(o*Math.PI/180),e.viewport.scale),l=e.viewport.scale,s=g(e.image,e.viewport),u=s.tlhc.x-1,d=s.tlhc.y-1,m=s.brhc.x-u,c=s.brhc.y-d;return"NONE"===s.presentationSizeMode?e.image.rowPixelSpacing<e.image.columnPixelSpacing?i*=e.image.columnPixelSpacing/e.image.rowPixelSpacing:e.image.columnPixelSpacing<e.image.rowPixelSpacing&&(l*=e.image.rowPixelSpacing/e.image.columnPixelSpacing):(i=s.columnPixelSpacing,l=s.rowPixelSpacing,"SCALE TO FIT"===s.presentationSizeMode&&(n=e.canvas.height/(c*l),r=e.canvas.width/(m*i),i=l=Math.min(r,n),s.rowPixelSpacing<s.columnPixelSpacing?i*=s.columnPixelSpacing/s.rowPixelSpacing:s.columnPixelSpacing<s.rowPixelSpacing&&(l*=s.rowPixelSpacing/s.columnPixelSpacing))),a.scale(i,l),0!==o&&a.rotate(-o*Math.PI/180),a.translate(e.viewport.translation.x,e.viewport.translation.y),0!==o&&a.rotate(o*Math.PI/180),void 0!==t&&a.scale(t,t),e.viewport.hflip&&a.scale(-1,1),e.viewport.vflip&&a.scale(1,-1),a.translate(-m/2,-c/2),a.translate(-u,-d),a},Ve=function(e,t){e=c(e),e=_e(e);return e.invert(),e.transformPoint(t.x,t.y)},Ue=function(e){if(void 0===e)throw new Error("disable: element must not be undefined");for(var t=o,n=0;n<t.length;n++)if(t[n].element===e){var r={element:e};f(e,d.ELEMENT_DISABLED,r),f(a,d.ELEMENT_DISABLED,r),t[n].element.removeChild(t[n].canvas),t[n].canvas=void 0,t.splice(n,1);break}},I=function(){return(window.performance?performance:Date).now()},Ne=function(e,t,n){if(void 0===e)throw new Error("displayImage: parameter element must not be undefined");if(void 0===t)throw new Error("displayImage: parameter image must not be undefined");var r,a=c(e),o=a.image;if(a.image=t,a.layers&&a.layers.length&&Q(e,t),void 0===a.viewport&&(a.viewport=l(a.canvas,t)),n)for(var i in n)null!==n[i]&&(a.viewport[i]=n[i]);void 0!==a.lastImageTimeStamp&&(r=(1e3/(I()-a.lastImageTimeStamp)).toFixed()),a.lastImageTimeStamp=I();t={viewport:a.viewport,element:a.element,image:a.image,oldImage:o,enabledElement:a,frameRate:r};f(a.element,d.NEW_IMAGE,t),m(e)},Be=function(e){e=c(e);r(e)},ke=function(){for(var e=o,t=0;t<e.length;t++){var n=e[t];!0===n.invalid&&r(n,!0)}},Fe=function(e){var t=c(e),n=t.image;t.viewport.scale=W(t.canvas,n,t.viewport.rotation).scaleFactor,t.viewport.translation.x=0,t.viewport.translation.y=0,m(e)};var Ge=function(e,t){var n,r,a,o,i,l=c(e),s=l.canvas.width,u=l.canvas.height;r=e,(n=l.canvas).width!==r.clientWidth&&(n.width=r.clientWidth,n.style.width="".concat(r.clientWidth,"px")),n.height!==r.clientHeight&&(n.height=r.clientHeight,n.style.height="".concat(r.clientHeight,"px")),f(e,d.ELEMENT_RESIZED,{element:e}),void 0!==l.image&&(t||(n=s,r=u,a=(t=l).viewport.scale,o=j(t.image,t.viewport.rotation),i=Math.round(o.width*a),o=Math.round(o.height*a),a=t.viewport.translation.x,t=t.viewport.translation.y,i===n&&o<=r)||i<=n&&o===r&&0===a&&0===t?Fe:(n=(i=l).viewport.scale,o=i.canvas.width,r=i.canvas.height,o=Math.sqrt(o/s*(r/u)),i.viewport.scale=o*n,m))(e)},ze=function(e){var t=(e.viewport||{}).invert,e=(e.options||{}).fillStyle;return-1!==["black","white"].indexOf(e)&&t?"white":"black"},qe=function(e,t,n){var r=I(),a=e.getPixelData(),o=(e.stats.lastGetPixelDataTime=I()-r,a.length),i=e.minPixelValue,l=3,s=0,r=I();if(a instanceof Int16Array)if(i<0)for(;s<o;)n[l]=t[a[s++]+-i],l+=4;else for(;s<o;)n[l]=t[a[s++]],l+=4;else if(a instanceof Uint16Array)for(;s<o;)n[l]=t[a[s++]],l+=4;else if(i<0)for(;s<o;)n[l]=t[a[s++]+-i],l+=4;else for(;s<o;)n[l]=t[a[s++]],l+=4;e.stats.lastStoredPixelDataToCanvasImageDataTime=I()-r},We=function(e,t,n){var r,a=I(),o=e.getPixelData(),i=(e.stats.lastGetPixelDataTime=I()-a,o.length),l=e.minPixelValue,s=0,u=0,a=I();if(o instanceof Int16Array)if(l<0)for(;u<i;)r=t[o[u++]+-l],n[s++]=r,n[s++]=r,n[s++]=r,n[s++]=255;else for(;u<i;)r=t[o[u++]],n[s++]=r,n[s++]=r,n[s++]=r,n[s++]=255;else if(o instanceof Uint16Array)for(;u<i;)r=t[o[u++]],n[s++]=r,n[s++]=r,n[s++]=r,n[s++]=255;else if(l<0)for(;u<i;)r=t[o[u++]+-l],n[s++]=r,n[s++]=r,n[s++]=r,n[s++]=255;else for(;u<i;)r=t[o[u++]],n[s++]=r,n[s++]=r,n[s++]=r,n[s++]=255;e.stats.lastStoredPixelDataToCanvasImageDataTime=I()-a},T=function(e,t,n){if(void 0===e)throw new Error("setToPixelCoordinateSystem: parameter enabledElement must not be undefined");if(void 0===t)throw new Error("setToPixelCoordinateSystem: parameter context must not be undefined");e=Oe(e,n);t.setTransform(e.m[0],e.m[1],e.m[2],e.m[3],e.m[4],e.m[5])},t={};var je={storedPixelDataToImageData:function(e){for(var t=e.getPixelData(),n=new Uint8Array(e.width*e.height*3),r=0,a=0;a<t.length;a++){var o=Math.abs(t[a]);n[r++]=255&o,n[r++]=o>>8,n[r++]=t[a]<0?0:1}return n}},He=(t.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0 + color.g*65536.0;if (color.b == 0.0)intensity = -intensity;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}",{});var Xe={storedPixelDataToImageData:function(e){for(var t=e.getPixelData(),n=new Uint8Array(e.width*e.height*2),r=0,a=0;a<t.length;a++)n[r++]=t[a],n[r++]=t[a]<0?0:1;return n}},Ye=(He.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.;if (color.a == 0.0)intensity = -intensity;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}",{});var Ke={storedPixelDataToImageData:function(e){var t=e.minPixelValue,n=0,r=0,a=e.width*e.height*4,o=e.width*e.height*3,i=e.getPixelData(),l=new Uint8Array(o);if(t<0)for(;r<a;)l[n++]=i[r++]+-t,l[n++]=i[r++]+-t,l[n++]=i[r++]+-t,r+=1;else for(;r<a;)l[n++]=i[r++],l[n++]=i[r++],l[n++]=i[r++],r+=1;return l}},Ze=(Ye.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform float minPixelValue;uniform int invert;varying vec2 v_texCoord;void main() {vec3 color = texture2D(u_image, v_texCoord).xyz;color = color * 256.0 * slope + intercept;float center0 = wc - 0.5 - minPixelValue;float width0 = max(ww, 1.0);color = (color - center0) / width0 + 0.5;gl_FragColor = vec4(color, 1);if (invert == 1)gl_FragColor.rgb = 1. - gl_FragColor.rgb;}",{});var $e={storedPixelDataToImageData:function(e){for(var t=e.getPixelData(),n=new Uint8Array(e.width*e.height*2),r=0,a=0;a<t.length;a++){var o=t[a];n[r++]=255&o,n[r++]=o>>8}return n}},Je=(Ze.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0 + color.a*65536.0;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}",{});var Qe={storedPixelDataToImageData:function(e){return e.getPixelData()}},C=(Je.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}",{int16:t,int8:He,rgb:Ye,uint16:Ze,uint8:Je}),et={int16:je,int8:Xe,rgb:Ke,uint16:$e,uint8:Qe},tt="attribute vec2 a_position;attribute vec2 a_texCoord;uniform vec2 u_resolution;varying vec2 v_texCoord;void main() {vec2 zeroToOne = a_position / u_resolution;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;}",L={},P=[],nt=268435456,R=0;function rt(){if(!(R<=nt)){for(P.sort(function(e,t){return e.timeStamp>t.timeStamp?-1:e.timeStamp<t.timeStamp?1:0});nt<R;){var e=P[P.length-1];R-=e.sizeInBytes,delete L[e.imageId],P.pop(),f(a,d.WEBGL_TEXTURE_REMOVED,{imageId:e.imageId})}var t={maximumSizeInBytes:nt,cacheSizeInBytes:R,numberOfImagesCached:P.length};f(a,d.WEBGL_TEXTURE_CACHE_FULL,t)}}var at={purgeCache:function(){for(;0<P.length;){var e=P.pop();delete L[e.imageId]}R=0},getImageTexture:function(e){if(void 0===e)throw new Error("getImageTexture: imageId must not be undefined");if(void 0!==(e=L[e]))return e.timeStamp=new Date,e.imageTexture},putImageTexture:function(e,t){var n=e.imageId;if(void 0===e)throw new Error("putImageTexture: image must not be undefined");if(void 0===n)throw new Error("putImageTexture: imageId must not be undefined");if(void 0===t)throw new Error("putImageTexture: imageTexture must not be undefined");if(!0===Object.prototype.hasOwnProperty.call(L,n))throw new Error("putImageTexture: imageId already in cache");if(e={imageId:n,imageTexture:t,timeStamp:new Date,sizeInBytes:t.sizeInBytes},L[n]=e,P.push(e),void 0===t.sizeInBytes)throw new Error("putImageTexture: imageTexture.sizeInBytes must not be undefined");if(void 0===t.sizeInBytes.toFixed)throw new Error("putImageTexture: imageTexture.sizeInBytes is not a number");R+=e.sizeInBytes,rt()},removeImageTexture:function(e){if(void 0===e)throw new Error("removeImageTexture: imageId must not be undefined");var t=L[e];if(void 0===t)throw new Error("removeImageTexture: imageId must not be undefined");return P.splice(P.indexOf(t),1),R-=t.sizeInBytes,delete L[e],t.imageTexture},setMaximumSizeBytes:function(e){if(void 0===e)throw new Error("setMaximumSizeBytes: parameter numBytes must not be undefined");if(void 0===e.toFixed)throw new Error("setMaximumSizeBytes: parameter numBytes must be a number");nt=e,rt()}};function ot(e,t,n){n=e.createShader(n);return e.shaderSource(n,t),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)||e.isContextLost()||(t=e.getShaderInfoLog(n),console.error("Could not compile shader:\n".concat(t))),n}var D,it,lt,st=function(e,t,n){var r,t=ot(e,t,e.VERTEX_SHADER),n=ot(e,n,e.FRAGMENT_SHADER);return t=t,n=n,r=(e=e).createProgram(),e.attachShader(r,t),e.attachShader(r,n),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS)||e.isContextLost()||(t=e.getProgramInfoLog(r),console.error("WebGL program filed to link:\n".concat(t))),r},S=document.createElement("canvas"),ut=!1;function dt(){if(!0!==ut&&function(e){D=null;try{var t={desynchronized:!0,preserveDrawingBuffer:!0};D=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),e.removeEventListener("webglcontextlost",mt,!1),e.addEventListener("webglcontextlost",mt,!1),e.removeEventListener("webglcontextrestored",ct,!1),e.addEventListener("webglcontextrestored",ct,!1)}catch(e){throw new Error("Error creating WebGL context")}D||(console.error("Unable to initialize WebGL. Your browser may not support it."),D=null);return D}(S)){for(var e in lt=D.createBuffer(),D.bindBuffer(D.ARRAY_BUFFER,lt),D.bufferData(D.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,0]),D.STATIC_DRAW),it=D.createBuffer(),D.bindBuffer(D.ARRAY_BUFFER,it),D.bufferData(D.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,0]),D.STATIC_DRAW),C){e=C[e];e.attributes={},e.uniforms={},e.vert=tt,e.program=st(D,e.vert,e.frag),e.attributes.texCoordLocation=D.getAttribLocation(e.program,"a_texCoord"),D.enableVertexAttribArray(e.attributes.texCoordLocation),e.attributes.positionLocation=D.getAttribLocation(e.program,"a_position"),D.enableVertexAttribArray(e.attributes.positionLocation),e.uniforms.resolutionLocation=D.getUniformLocation(e.program,"u_resolution")}ut=!0}}function mt(e){e.preventDefault(),console.warn("WebGL Context Lost!")}function ct(e){e.preventDefault(),ut=!1,at.purgeCache(),dt()}function gt(e){return e.color?"rgb":(e=e.getPixelData())instanceof Int16Array?"int16":e instanceof Uint16Array?"uint16":e instanceof Int8Array?"int8":"uint8"}function ft(e){var t,n,r,a,o,i=at.getImageTexture(e.imageId);return i||(t=e,n={uint8:D.LUMINANCE,int8:D.LUMINANCE_ALPHA,uint16:D.LUMINANCE_ALPHA,int16:D.RGB,rgb:D.RGB},r=gt(t),n=n[r],a=D.createTexture(),D.bindTexture(D.TEXTURE_2D,a),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,D.NEAREST),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,D.NEAREST),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_S,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_T,D.CLAMP_TO_EDGE),D.pixelStorei(D.UNPACK_ALIGNMENT,1),o=et[r].storedPixelDataToImageData(t,t.width,t.height),D.texImage2D(D.TEXTURE_2D,0,n,t.width,t.height,0,n,D.UNSIGNED_BYTE,o),i={texture:a,sizeInBytes:t.width*t.height*{int8:1,uint16:2,int16:3,rgb:3}[r]},at.putImageTexture(e,i)),i.texture}function ht(e,t,n,r,a){for(var o in D.clearColor(1,0,0,1),D.viewport(0,0,r,a),D.clear(D.COLOR_BUFFER_BIT|D.DEPTH_BUFFER_BIT),D.useProgram(e.program),D.bindBuffer(D.ARRAY_BUFFER,it),D.vertexAttribPointer(e.attributes.texCoordLocation,2,D.FLOAT,!1,0,0),D.bindBuffer(D.ARRAY_BUFFER,lt),D.vertexAttribPointer(e.attributes.positionLocation,2,D.FLOAT,!1,0,0),t){var i,l=D.getUniformLocation(e.program,o);l&&(i=(o=t[o]).type,o=o.value,"i"===i?D.uniform1i(l,o):"f"===i?D.uniform1f(l,o):"2f"===i&&D.uniform2f(l,o[0],o[1]))}var s;(s=D).bufferData(s.ARRAY_BUFFER,new Float32Array([r,a,0,a,r,0,0,0]),s.STATIC_DRAW),D.activeTexture(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,n),D.drawArrays(D.TRIANGLE_STRIP,0,4)}var t={createProgramFromString:st,renderer:{render:function(e){var t=e.image,e=(S.width=t.width,S.height=t.height,e.viewport),n=(n=gt(n=t),C.hasOwnProperty(n)?C[n]:C.rgb),r=ft(t);return ht(n,{u_resolution:{type:"2f",value:[t.width,t.height]},wc:{type:"f",value:e.voi.windowCenter},ww:{type:"f",value:e.voi.windowWidth},slope:{type:"f",value:t.slope},intercept:{type:"f",value:t.intercept},minPixelValue:{type:"f",value:t.minPixelValue},invert:{type:"i",value:e.invert?1:0}},r,t.width,t.height),S},initRenderer:dt,getRenderCanvas:function(){return S},isWebGLAvailable:function(){var e={failIfMajorPerformanceCaveat:!0};try{var t=document.createElement("canvas");return Boolean(window.WebGLRenderingContext)&&(t.getContext("webgl",e)||t.getContext("experimental-webgl",e))}catch(e){return!1}}},textureCache:at},A=(Object.defineProperty(t,"isWebGLInitialized",{enumerable:!0,configurable:!1,get:function(){return ut}}),t);function vt(e,t){var n,r;(r=e).voiLUT&&r.voiLUT.lut&&0<r.voiLUT.lut.length||void 0!==r.voi.windowWidth&&void 0!==r.voi.windowCenter||(n=(r=t.maxPixelValue*t.slope+t.intercept)-(t=t.minPixelValue*t.slope+t.intercept),r=(r+t)/2,void 0===e.voi?e.voi={windowWidth:n,windowCenter:r}:(e.voi.windowWidth=n,e.voi.windowCenter=r))}function pt(e,t){return!e&&!t||!(!e||!t)&&e.id===t.id}function wt(e,t,n){var r,a,o,i,l,s;return n?(a=(r=n).lut[0],o=r.lut[r.lut.length-1],i=r.firstValueMapped+r.lut.length,function(e){return e<r.firstValueMapped?a:i<=e?o:r.lut[e]}):(l=e,s=t,function(e){return e*l+s})}function bt(e){return function(e){if(Array.isArray(e))return yt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){var n;if(e)return"string"==typeof e?yt(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?yt(e,t):void 0}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function yt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var xt=function(e,t,n,r){var a,o,i,l,s,u,d,m;return n?(a=n,o=r,i=Math.max.apply(Math,bt(a.lut)).toString(2).length-8,l=a.lut[0]>>i,s=a.lut[a.lut.length-1]>>i,u=a.firstValueMapped+a.lut.length-1,function(e){return e<a.firstValueMapped?l:u<=e?s:o?a.lut[Math.round(e)-a.firstValueMapped]>>i:a.lut[e-a.firstValueMapped]>>i}):(d=e,m=t,function(e){return 255*((e-m)/d+.5)})},Et=function(e,t,n,r,a,o){var i=e.maxPixelValue,l=e.minPixelValue,s=Math.min(l,0),u=(void 0===e.cachedLut&&(d=i-s+1,e.cachedLut={},e.cachedLut.lutArray=new Uint8ClampedArray(d)),e.cachedLut.lutArray),d=Boolean(e.slope%1)||Boolean(e.intercept%1),m=wt(e.slope,e.intercept,a),c=xt(t,n,o,d);if(!0===r)for(var g=l;g<=i;g++)u[g+-s]=255-c(m(g));else for(var f=l;f<=i;f++)u[f+-s]=c(m(f));return u},It=function(e,t,n){return void 0!==e.cachedLut&&e.cachedLut.windowCenter===t.voi.windowCenter&&e.cachedLut.windowWidth===t.voi.windowWidth&&pt(e.cachedLut.modalityLUT,t.modalityLUT)&&pt(e.cachedLut.voiLUT,t.voiLUT)&&e.cachedLut.invert===t.invert&&!0!==n||(vt(t,e),Et(e,t.voi.windowWidth,t.voi.windowCenter,t.invert,t.modalityLUT,t.voiLUT),e.cachedLut.windowWidth=t.voi.windowWidth,e.cachedLut.windowCenter=t.voi.windowCenter,e.cachedLut.invert=t.invert,e.cachedLut.voiLUT=t.voiLUT,e.cachedLut.modalityLUT=t.modalityLUT),e.cachedLut.lutArray},Tt=function(e,t){var n=e.renderingTools.lastRenderedImageId,r=e.renderingTools.lastRenderedViewport;return t.imageId!==n||!r||r.windowCenter!==e.viewport.voi.windowCenter||r.windowWidth!==e.viewport.voi.windowWidth||r.invert!==e.viewport.invert||r.rotation!==e.viewport.rotation||r.hflip!==e.viewport.hflip||r.vflip!==e.viewport.vflip||r.modalityLUT!==e.viewport.modalityLUT||r.voiLUT!==e.viewport.voiLUT||r.colormap!==e.viewport.colormap},_=function(e,t){var n=e.renderingTools.renderCanvas,r=(n.width=t.width,n.height=t.height,n.getContext("2d",{desynchronized:!0})),n=(r.fillStyle="white",r.fillRect(0,0,n.width,n.height),r.getImageData(0,0,t.width,t.height));e.renderingTools.renderCanvasContext=r,e.renderingTools.renderCanvasData=n},M=function(e){var t=e.image.imageId,n=e.viewport,r=e.image.color;return e.renderingTools.lastRenderedImageId=t,e.renderingTools.lastRenderedIsColor=r,e.renderingTools.lastRenderedViewport={windowCenter:n.voi.windowCenter,windowWidth:n.voi.windowWidth,invert:n.invert,rotation:n.rotation,hflip:n.hflip,vflip:n.vflip,modalityLUT:n.modalityLUT,voiLUT:n.voiLUT,colormap:n.colormap},e.renderingTools};function Ct(e,t,n,r){var a,o,r=!(3<arguments.length&&void 0!==r)||r,i=!0===e.renderingTools.lastRenderedIsColor,i=(e.renderingTools.renderCanvas&&!i||(e.renderingTools.renderCanvas=document.createElement("canvas"),_(e,t)),e.renderingTools.renderCanvas);return!1===Tt(e,t)&&!0!==n||(i.width===t.width&&i.height===t.height||_(e,t),a=I(),n=It(t,e.viewport,n),t.stats=t.stats||{},t.stats.lastLutGenerateTime=I()-a,o=e.renderingTools.renderCanvasData,e=e.renderingTools.renderCanvasContext,(r?qe:We)(t,n,o.data),a=I(),e.putImageData(o,0,0),t.stats.lastPutImageDataTime=I()-a),i}function Lt(e,t){if(void 0===e)throw new Error("drawImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("drawImage: image must be loaded before it can be drawn");var r=e.canvas.getContext("2d",{desynchronized:!0}),t=(r.setTransform(1,0,0,1,0,0),r.fillStyle=ze(e),r.fillRect(0,0,e.canvas.width,e.canvas.height),r.imageSmoothingEnabled=!e.viewport.pixelReplication,r.mozImageSmoothingEnabled=r.imageSmoothingEnabled,T(e,r),n=e.options&&e.options.renderer&&"webgl"===e.options.renderer.toLowerCase()?A.renderer.render(e):Ct(e,n,t),g(e.image,e.viewport)),a=t.tlhc.x-1,o=t.tlhc.y-1,i=t.brhc.x-a,t=t.brhc.y-o;r.drawImage(n,a,o,i,t,a,o,i,t),e.renderingTools=M(e)}function Pt(e,t,n,r,a){var o,i=e.maxPixelValue,l=e.minPixelValue,s=Math.min(l,0),u=(void 0===e.cachedLut&&(o=i-s+1,e.cachedLut={},e.cachedLut.lutArray=new Uint8ClampedArray(o)),e.cachedLut.lutArray),d=xt(t,n,a);if(!0===r)for(var m=l;m<=i;m++)u[m+-s]=255-d(m);else for(var c=l;c<=i;c++)u[c+-s]=d(c)}var Rt=function(e,t,n){var r=I(),a=e.getPixelData(),o=(e.stats.lastGetPixelDataTime=I()-r,e.minPixelValue),i=0,l=0,s=a.length,r=I();if(o<0)for(;l<s;)n[i++]=t[a[l++]+-o],n[i++]=t[a[l++]+-o],n[i]=t[a[l]+-o],l+=2,i+=2;else for(;l<s;)n[i++]=t[a[l++]],n[i++]=t[a[l++]],n[i]=t[a[l]],l+=2,i+=2;e.stats.lastStoredPixelDataToCanvasImageDataTime=I()-r},Dt=function(e,t,n){var r=I(),a=e.getPixelData(),o=(e.stats.lastGetPixelDataTime=I()-r,e.minPixelValue),i=0,l=0,s=a.length,r=I();if(o<0)for(;l<s;)n[i++]=t[a[l++]+-o],n[i++]=t[a[l++]+-o],n[i++]=t[a[l++]+-o],n[i++]=a[l++];else for(;l<s;)n[i++]=t[a[l++]],n[i++]=t[a[l++]],n[i++]=t[a[l++]],n[i++]=a[l++];e.stats.lastStoredPixelDataToCanvasImageDataTime=I()-r};function St(e,t,n){var r,a,o=!0===e.renderingTools.lastRenderedIsColor,o=(e.renderingTools.renderCanvas&&o||(e.renderingTools.renderCanvas=document.createElement("canvas")),e.renderingTools.renderCanvas);return 255===e.viewport.voi.windowWidth&&128===e.viewport.voi.windowCenter&&!1===e.viewport.invert&&t.getCanvas&&t.getCanvas()?t.getCanvas():(!1===Tt(e,t)&&!0!==n||(o.width===t.width&&o.height===t.height||_(e,t),n=I(),a=t,r=e.viewport,void 0!==a.cachedLut&&a.cachedLut.windowCenter===r.voi.windowCenter&&a.cachedLut.windowWidth===r.voi.windowWidth&&a.cachedLut.invert===r.invert||(Pt(a,r.voi.windowWidth,r.voi.windowCenter,r.invert),a.cachedLut.windowWidth=r.voi.windowWidth,a.cachedLut.windowCenter=r.voi.windowCenter,a.cachedLut.invert=r.invert),r=a.cachedLut.lutArray,t.stats=t.stats||{},t.stats.lastLutGenerateTime=I()-n,a=e.renderingTools.renderCanvasData,e=e.renderingTools.renderCanvasContext,(t.rgba?Dt:Rt)(t,r,a.data),n=I(),e.putImageData(a,0,0),t.stats.lastPutImageDataTime=I()-n),o)}function O(e,t){if(void 0===e)throw new Error("renderColorImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("renderColorImage: image must be loaded before it can be drawn");var r=e.canvas.getContext("2d",{desynchronized:!0}),t=(r.setTransform(1,0,0,1,0,0),r.fillStyle=ze(e),r.fillRect(0,0,e.canvas.width,e.canvas.height),r.imageSmoothingEnabled=!e.viewport.pixelReplication,r.mozImageSmoothingEnabled=r.imageSmoothingEnabled,T(e,r),n=e.options&&e.options.renderer&&"webgl"===e.options.renderer.toLowerCase()?A.renderer.render(e):St(e,n,t),g(e.image,e.viewport)),a=t.tlhc.x-1,o=t.tlhc.y-1,i=t.brhc.x-a,t=t.brhc.y-o;r.drawImage(n,a,o,i,t,a,o,i,t),e.renderingTools=M(e)}var At=function(e,t,n,r){var a,o=I(),i=e.getPixelData(),l=(e.stats.lastGetPixelDataTime=I()-o,i.length),s=e.minPixelValue,u=0,d=0,o=I(),m=n instanceof v.LookupTable?n.Table:n;if(s<0)for(;d<l;)a=m[t[i[d++]+-s]],r[u++]=a[0],r[u++]=a[1],r[u++]=a[2],r[u++]=a[3];else for(;d<l;)a=m[t[i[d++]]],r[u++]=a[0],r[u++]=a[1],r[u++]=a[2],r[u++]=a[3];e.stats.lastStoredPixelDataToCanvasImageDataTime=I()-o};function _t(e,t,n){e.renderingTools.renderCanvas||(e.renderingTools.renderCanvas=document.createElement("canvas"));var r,a,o=e.renderingTools.renderCanvas,i=e.viewport.colormap||e.options.colormap;if(e.options&&e.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),i=i&&"string"==typeof i?v.getColormap(i):i)return a=i.getId(),!1===Tt(e,t)&&!0!==n&&e.renderingTools.colormapId===a||(o.width===t.width&&o.height===t.height||_(e,t),r=I(),e.renderingTools.colorLut&&!n&&e.renderingTools.colormapId===a||(i.setNumberOfColors(256),e.renderingTools.colorLut=i.createLookupTable(),e.renderingTools.colormapId=a),i=It(t,e.viewport,n),t.stats=t.stats||{},t.stats.lastLutGenerateTime=I()-r,a=e.renderingTools.colorLut,n=e.renderingTools.renderCanvasData,e=e.renderingTools.renderCanvasContext,At(t,i,a,n.data),r=I(),e.putImageData(n,0,0),t.stats.lastPutImageDataTime=I()-r),o;throw new Error("renderPseudoColorImage: colormap not found.")}function Mt(e,t){if(void 0===e)throw new Error("drawImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("drawImage: image must be loaded before it can be drawn");var r=e.canvas.getContext("2d",{desynchronized:!0}),n=(r.setTransform(1,0,0,1,0,0),r.fillStyle=ze(e),r.fillRect(0,0,e.canvas.width,e.canvas.height),r.imageSmoothingEnabled=!e.viewport.pixelReplication,r.mozImageSmoothingEnabled=r.imageSmoothingEnabled,T(e,r),_t(e,n,t)),t=g(e.image,e.viewport),a=t.tlhc.x-1,o=t.tlhc.y-1,i=t.brhc.x-a,t=t.brhc.y-o;r.drawImage(n,a,o,i,t,a,o,i,t),e.renderingTools=M(e)}var Ot=function(e,t,n){var r,a=I(),o=e.getPixelData(),i=(e.stats.lastGetPixelDataTime=I()-a,o.length),l=e.minPixelValue,s=0,u=0,a=I(),d=t instanceof v.LookupTable?t.Table:t;if(l<0)for(;u<i;)r=d[o[u++]+-l],n[s++]=r[0],n[s++]=r[1],n[s++]=r[2],n[s++]=r[3];else for(;u<i;)r=d[o[u++]],n[s++]=r[0],n[s++]=r[1],n[s++]=r[2],n[s++]=r[3];e.stats.lastStoredPixelDataToCanvasImageDataTime=I()-a};function Vt(e,t,n){e.renderingTools.renderCanvas||(e.renderingTools.renderCanvas=document.createElement("canvas"));var r,a,o=e.renderingTools.renderCanvas,i=e.viewport.colormap||e.options.colormap;if(e.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),i=i&&"string"==typeof i?v.getColormap(i):i)return a=i.getId(),!1===Tt(e,t)&&!0!==n&&e.renderingTools.colormapId===a||(o.width===t.width&&o.height===t.height||_(e,t),r=I(),e.renderingTools.colorLut&&!n&&e.renderingTools.colormapId===a||(e.renderingTools.colorLut=i.createLookupTable(),e.renderingTools.colormapId=a),t.stats=t.stats||{},t.stats.lastLutGenerateTime=I()-r,n=e.renderingTools.colorLut,i=e.renderingTools.renderCanvasData,a=e.renderingTools.renderCanvasContext,Ot(t,n,i.data),r=I(),a.putImageData(i,0,0),t.stats.lastPutImageDataTime=I()-r),o;throw new Error("renderLabelMapImage: colormap not found.")}function Ut(e,t){if(void 0===e)throw new Error("renderLabelMapImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("renderLabelMapImage: image must be loaded before it can be drawn");var r=e.canvas.getContext("2d",{desynchronized:!0}),n=(r.setTransform(1,0,0,1,0,0),r.fillStyle=ze(e),r.fillRect(0,0,e.canvas.width,e.canvas.height),r.imageSmoothingEnabled=!e.viewport.pixelReplication,r.mozImageSmoothingEnabled=r.imageSmoothingEnabled,T(e,r),Vt(e,n,t)),t=g(e.image,e.viewport),a=t.tlhc.x-1,o=t.tlhc.y-1,i=t.brhc.x-a,t=t.brhc.y-o;r.drawImage(n,a,o,i,t,a,o,i,t),e.renderingTools=M(e)}function Nt(e){var t=e.syncProps||{};t.originalScale=e.viewport.scale,e.syncProps=t}function Bt(e,r){e.forEach(function(e){var t,n;e!==r&&e.viewport&&r.viewport&&(e.syncProps||Nt(e),n=e,(t=r).syncProps||Nt(t),n.syncProps||Nt(n),n=n.syncProps.originalScale/t.syncProps.originalScale,e.viewport.scale=r.viewport.scale*n,e.viewport.rotation=r.viewport.rotation,e.viewport.translation={x:r.viewport.translation.x/n,y:r.viewport.translation.y/n},e.viewport.hflip=r.viewport.hflip,e.viewport.vflip=r.viewport.vflip)})}function kt(s,e,u){e.forEach(function(e,t){if(e.image){s.save(),e.canvas=s.canvas,T(e,s);var n=e.viewport.colormap||e.options.colormap,r=e.viewport.labelmap,a=e.invalid||u;if(n&&""!==n&&!0===r){var r=e,o=a;if(void 0===r)throw new Error("addLabelMapLayer: layer parameter must not be undefined");var i=r.image;if(void 0===i)throw new Error("addLabelMapLayer: image must be loaded before it can be drawn");r.canvas=Vt(r,i,o),(i=r.canvas.getContext("2d",{desynchronized:!0})).imageSmoothingEnabled=!r.viewport.pixelReplication,i.mozImageSmoothingEnabled=i.imageSmoothingEnabled,r.renderingTools=M(r)}else if(n&&""!==n){o=e,i=a;if(void 0===o)throw new Error("addPseudoColorLayer: layer parameter must not be undefined");r=o.image;if(void 0===r)throw new Error("addPseudoColorLayer: image must be loaded before it can be drawn");o.canvas=_t(o,r,i),(r=o.canvas.getContext("2d",{desynchronized:!0})).imageSmoothingEnabled=!o.viewport.pixelReplication,r.mozImageSmoothingEnabled=r.imageSmoothingEnabled,o.renderingTools=M(o)}else if(!0===e.image.color){n=e,r=a;if(void 0===n)throw new Error("addColorLayer: layer parameter must not be undefined");var l=n.image;if(void 0===l)throw new Error("addColorLayer: image must be loaded before it can be drawn");l.rgba=!0,n.canvas=St(n,l,r),(l=n.canvas.getContext("2d",{desynchronized:!0})).imageSmoothingEnabled=!n.viewport.pixelReplication,l.mozImageSmoothingEnabled=l.imageSmoothingEnabled,n.renderingTools=M(n)}else!function(e,t,n){if(n=2<arguments.length&&void 0!==n&&n,void 0===e)throw new Error("addGrayscaleLayer: layer parameter must not be undefined");var r=e.image;if(void 0===r)throw new Error("addGrayscaleLayer: image must be loaded before it can be drawn");e.canvas=Ct(e,r,t,n),(r=e.canvas.getContext("2d",{desynchronized:!0})).imageSmoothingEnabled=!e.viewport.pixelReplication,r.mozImageSmoothingEnabled=r.imageSmoothingEnabled,e.renderingTools=M(e)}(e,a,0===t);e.options&&e.options.opacity?s.globalAlpha=e.options.opacity:s.globalAlpha=1,e.options&&e.options.fillStyle&&(s.fillStyle=e.options.fillStyle),s.imageSmoothingEnabled=!e.viewport.pixelReplication,s.mozImageSmoothingEnabled=s.imageSmoothingEnabled;r=g(e.image,e.viewport),l=r.tlhc.x-1,n=r.tlhc.y-1,a=r.brhc.x-l,t=r.brhc.y-n;s.drawImage(e.canvas,l,n,a,t,l,n,a,t),s.restore(),e.invalid=!1}})}function Ft(e,t){var n,r=e.image,a=e.element,o=e.layers||[];e.canvas&&e.image&&(n=I(),r.stats={lastGetPixelDataTime:-1,lastStoredPixelDataToCanvasImageDataTime:-1,lastPutImageDataTime:-1,lastRenderTime:-1,lastLutGenerateTime:-1},o&&o.length?Gt(e,t):r&&(r.render||(e.viewport.colormap&&""!==e.viewport.colormap&&!0===e.image.labelmap?Ut:e.viewport.colormap&&""!==e.viewport.colormap?Mt:r.color?O:Lt))(e,t),o=I()-n,t={viewport:e.viewport,element:a,image:r,enabledElement:e,canvasContext:e.canvas.getContext("2d",{desynchronized:!0}),renderTimeInMs:o},r.stats.lastRenderTime=o,e.invalid=!1,e.needsRedraw=!1,f(a,d.IMAGE_RENDERED,t))}var Gt=function(e,t){var n=e.element,r=$(n),a=u(n),n=J(n),o=!e.lastSyncViewportsState&&e.syncViewports,o=(e.lastSyncViewportsState=e.syncViewports,o&&r.forEach(function(e){e.viewport&&Nt(e)}),!0===e.syncViewports&&Bt(n,a),e.canvas.getContext("2d",{desynchronized:!0}));o.setTransform(1,0,0,1,0,0),o.fillStyle="black",o.fillRect(0,0,e.canvas.width,e.canvas.height),kt(o,n,t)};function zt(e){A.renderer.isWebGLAvailable()?(A.renderer.initRenderer(),e.renderer="webgl",e.desynchronized=!0,e.preserveDrawingBuffer=!0):(console.error("WebGL not available, falling back to Canvas renderer"),delete e.renderer,delete e.preserveDrawingBuffer)}var qt=function(e){return window.requestAnimationFrame(e)||window.webkitRequestAnimationFrame(e)||window.mozRequestAnimationFrame(e)||window.oRequestAnimationFrame(e)||window.msRequestAnimationFrame(e)||void window.setTimeout(e,1e3/60)},Wt="cornerstone-canvas";function jt(e){var t="canvas.".concat(Wt);return e.querySelector(t)||(t=e,(e=document.createElement("canvas")).style.display="block",e.classList.add(Wt),t.appendChild(e),e)}var Ht=function(e,t){if(void 0===e)throw new Error("enable: parameter element cannot be undefined");t&&t.renderer&&"webgl"===t.renderer.toLowerCase()&&zt(t);var n,r={element:e,canvas:jt(e),image:void 0,invalid:!1,needsRedraw:!0,options:Object.assign({},t),layers:[],data:{},renderingTools:{},uuid:(n=(new Date).getTime(),"undefined"!=typeof performance&&"function"==typeof performance.now&&(n+=performance.now()),"x.x.x.x.x.x.xxxx.xxx.x.x.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"===e?t:3&t|8).toString(16)}))};B(r),f(a,d.ELEMENT_ENABLED,r),Ge(e,!0),function e(t){void 0!==r.canvas&&(f(r.element,d.PRE_RENDER,{enabledElement:r,timestamp:t}),r.needsRedraw&&(void 0!==(t=r).image||0<t.layers.length)&&Ft(r,r.invalid),qt(e))}()},Xt=function(e,t){e=c(e);return l(e.canvas,t)},Yt=function(e){return c(e).image},Kt=function(e,t,n,r,a){if(void 0===e)throw new Error("getStoredPixels: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);for(var o=c(e),i=[],l=0,s=o.image.getPixelData(),u=0;u<a;u++)for(var d=0;d<r;d++){var m=(u+n)*o.image.columns+(d+t);i[l++]=s[m]}return i},Zt=function(e,t,n,r,a){t=Kt(e,t,n,r,a),n=c(e),r=wt(n.image.slope,n.image.intercept,n.viewport.modalityLUT);return t.map(r)},$t=function(e){e=c(e).viewport;if(void 0!==e)return Object.assign({},e)},Jt={drawImage:r,generateLut:Et,getDefaultViewport:l,requestAnimationFrame:qt,setDefaultViewport:q,storedPixelDataToCanvasImageData:qe,storedPixelDataToCanvasImageDataRGBA:We,storedPixelDataToCanvasImageDataColorLUT:Ot,storedPixelDataToCanvasImageDataPseudocolorLUT:At,storedColorPixelDataToCanvasImageData:Rt,getTransform:_e,calculateTransform:Oe,Transform:Me},Qt=function(e){var t=c(e);t.invalid=!0,t.needsRedraw=!0,f(e,d.INVALIDATED,{element:e})},e5=function(e){k(e).forEach(function(e){r(e,!0)})},V=[];var t5={addProvider:function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=0;n<V.length&&!(V[n].priority<=t);n++);V.splice(n,0,{priority:t,provider:e})},removeProvider:function(e){for(var t=0;t<V.length;t++)if(V[t].provider===e){V.splice(t,1);break}},get:function(e,t){for(var n=0;n<V.length;n++){var r=V[n].provider(e,t);if(void 0!==r)return r}}},n5=function(e,t,n){var r=c(e);if(void 0===r.image)throw new Error("image has not been loaded yet");e=e.getBoundingClientRect(),t={x:t-e.left-window.pageXOffset,y:n-e.top-window.pageYOffset},n=_e(r);return n.invert(),n.transformPoint(t.x,t.y)},r5=function(e,t){e=c(e);return _e(e).transformPoint(t.x,t.y)};var a5=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;if(void 0===e)throw new Error("renderToCanvas: parameter canvas cannot be undefined");r&&r.renderer&&"webgl"===r.renderer.toLowerCase()&&zt(r);var a=l(e,t),e=(n&&Object.assign(a,n),{element:n=e,canvas:n,image:t,invalid:!0,needsRedraw:!0,options:r,layers:[],data:{},renderingTools:{},viewport:a}),n={enabledElement:e,timestamp:Date.now()};f(e.element,d.PRE_RENDER,n),Ft(e,e.invalid)};function o5(e,t){if(void 0===e)throw new Error("renderWebImage: enabledElement parameter must not be undefined");var n,r,a,o,i,l=e.image;if(void 0===l)throw new Error("renderWebImage: image must be loaded before it can be drawn");e.viewport.voi.windowWidth===e.image.windowWidth&&e.viewport.voi.windowCenter===e.image.windowCenter&&!1===e.viewport.invert?((n=e.canvas.getContext("2d",{desynchronized:!0})).setTransform(1,0,0,1,0,0),n.fillStyle="black",n.fillRect(0,0,e.canvas.width,e.canvas.height),n.imageSmoothingEnabled=!e.viewport.pixelReplication,n.mozImageSmoothingEnabled=n.imageSmoothingEnabled,T(e,n),r=(i=g(e.image,e.viewport)).tlhc.x-1,a=i.tlhc.y-1,o=i.brhc.x-r,i=i.brhc.y-a,n.drawImage(l.getImage(),r,a,o,i,r,a,o,i)):O(e,t)}var i5={colorImage:O,grayscaleImage:Lt,webImage:o5,pseudoColorImage:Mt,labelMapImage:Ut,toCanvas:a5},l5=function(e){var t=c(e);t.viewport=l(t.canvas,t.image),m(e)},s5=function(e,t){var n=c(e);if(void 0===n.viewport&&(n.viewport=l(n.canvas)),t)for(var r in t)null!==t[r]&&(n.viewport[r]=t[r]);n.viewport.voi.windowWidth&&(n.viewport.voi.windowWidth=Math.max(n.viewport.voi.windowWidth,1e-6)),n.viewport.scale&&(n.viewport.scale=Math.max(n.viewport.scale,1e-4)),n.viewport.rotation%=360,n.viewport.rotation<0&&(n.viewport.rotation+=360),n.image&&m(e)};e.default={drawImage:r,generateLut:Et,getDefaultViewport:l,requestAnimationFrame:qt,storedPixelDataToCanvasImageData:qe,storedColorPixelDataToCanvasImageData:Rt,storedPixelDataToCanvasImageDataColorLUT:Ot,storedPixelDataToCanvasImageDataPseudocolorLUT:At,internal:Jt,renderLabelMapImage:Ut,renderPseudoColorImage:Mt,renderColorImage:O,renderGrayscaleImage:Lt,renderWebImage:o5,renderToCanvas:a5,canvasToPixel:Ve,disable:Ue,displayImage:Ne,draw:Be,drawInvalidated:ke,enable:Ht,getElementData:me,removeElementData:ce,getEnabledElement:c,addEnabledElement:B,getEnabledElementsByImageId:k,getEnabledElements:F,addLayer:Y,removeLayer:K,getLayer:Z,getLayers:$,getVisibleLayers:J,setActiveLayer:s,getActiveLayer:u,purgeLayers:ee,setLayerImage:Q,fitToWindow:Fe,getDefaultViewportForImage:Xt,getDisplayedArea:g,setDefaultViewport:q,getImage:Yt,getPixels:Zt,getStoredPixels:Kt,getViewport:$t,loadImage:xe,loadAndCacheImage:Ee,registerImageLoader:Ie,registerUnknownImageLoader:Te,invalidate:Qt,invalidateImageId:e5,pageToPixel:n5,pixelToCanvas:r5,reset:l5,resize:Ge,setToPixelCoordinateSystem:T,setViewport:s5,updateImage:m,pixelDataToFalseColorData:le,rendering:i5,imageCache:we,metaData:t5,webGL:A,colors:v,convertImageToFalseColorImage:ue,convertToFalseColorImage:de,restoreImage:se,EVENTS:d,events:a,triggerEvent:f,imageLoadPoolManager:De,imageRetrievalPoolManager:Se,RequestPoolManager:Re}}],r={},a.m=n,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)a.d(n,r,function(e){return t[e]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0);function a(e){var t;return(r[e]||(t=r[e]={i:e,l:!1,exports:{}},n[e].call(t.exports,t,t.exports,a),t.l=!0,t)).exports}var n,r});
//# sourceMappingURL=cornerstone.min.js.map